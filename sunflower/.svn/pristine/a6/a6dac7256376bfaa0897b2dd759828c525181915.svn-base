<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="site.unp.dao.instance.case">

	<!-- 사례 조건 -->
	<sql id="case-where">
	    <if test='menuNo != 100214 and menuNo != 100219'>
			<if test='condFrdate != null and condFrdate != ""'>
				<if test='searchDateType == "caseUdate" and searchDateType != null'>
					<![CDATA[   AND DATE_FORMAT(A.CASE_UDATE,'%Y-%m-%d') >= #{condFrdate}     ]]>
				</if>
				<if test='searchDateType == "caseDate" and searchDateType != null'>
					<![CDATA[   AND A.CASE_DATE >= #{condFrdate}     ]]>
				</if>
			</if>
			<if test='condTodate != null and condTodate != ""'>
				<if test='searchDateType == "caseUdate" and searchDateType != null'>
					<![CDATA[   AND DATE_FORMAT(A.CASE_UDATE,'%Y-%m-%d') <= #{condTodate}   ]]>
				</if>
				<if test='searchDateType == "caseDate" and searchDateType != null'>
					<![CDATA[   AND A.CASE_DATE <= #{condTodate}   ]]>
				</if>
			</if>
		</if>
		<if test='menuNo == 100214 and searchAll == "N"'>
		    <if test='condFrdate != null and condFrdate != ""'>
				<if test='searchDateType == "caseUdate" and searchDateType != null'>
					<![CDATA[   AND DATE_FORMAT(A.CASE_UDATE,'%Y-%m-%d') >= #{condFrdate}     ]]>
				</if>
				<if test='searchDateType == "caseDate" and searchDateType != null'>
					<![CDATA[   AND A.CASE_DATE >= #{condFrdate}     ]]>
				</if>
	        </if>
	        <if test='condTodate != null and condTodate != ""'>
				<if test='searchDateType == "caseUdate" and searchDateType != null'>
					<![CDATA[   AND DATE_FORMAT(A.CASE_UDATE,'%Y-%m-%d') <= #{condTodate}   ]]>
				</if>
				<if test='searchDateType == "caseDate" and searchDateType != null'>
					<![CDATA[   AND A.CASE_DATE <= #{condTodate}   ]]>
				</if>
		    </if> 
		</if>
		<if test='userLevel != "CU" and userLevel != "CA" and userLevel != "ROLE_SUPER"'>
			<if test='scCenterCodeSub != null and scCenterCodeSub != ""'>
				<![CDATA[ 	AND	A.CENTER_CODE = #{scCenterCodeSub} ]]>
			</if>
		</if>
		<choose>
			<when test='centerCodeSub != null and centerCodeSub != ""'>
				<![CDATA[AND A.CENTER_CODE = #{centerCodeSub}]]>
			</when>
			<when test='(centerCode != null and centerCode != "") and centerCode != "XXX"'>
				<![CDATA[AND SUBSTR(A.CENTER_CODE, 1, 1) = #{centerCode}]]>
			</when>
		</choose>
		<!-- <if test='centerCodeSub != null and centerCodeSub != ""'>
			<![CDATA[ 	AND	A.CENTER_CODE = #{centerCodeSub} ]]>
		</if> -->
		<if test='srcCslId != null and srcCslId != ""'>
			<if test='menuNo != 100219'>
				<![CDATA[ 	AND	A.MEMBER_ID = #{srcCslId} ]]>
			</if>
		</if>
		<if test='caseManager != null and caseManager != ""'>
			<![CDATA[ 	AND	A.CASE_MANAGER = #{caseManager} ]]>
		</if>
		<if test='chkCsTypeArr != null and chkCsTypeArr != ""'>
			<![CDATA[ 	AND	A.CASE_TYPE IN ]]>
			<foreach collection="chkCsType" item="code" index="index" separator=", " open="(" close=")">
		        #{code}
		     </foreach>
		</if>
		<if test='chkCsJupsooArr != null and chkCsJupsooArr != ""'>
			<![CDATA[ 	AND	A.CASE_JUPSOO IN ]]>
			<foreach collection="chkCsJupsoo" item="code" index="index" separator=", " open="(" close=")">
		        #{code}
		     </foreach>
		</if>
		<if test='finishCaseCheck != null and finishCaseCheck != ""'>
			<![CDATA[ 	AND A.CASE_FINISH ='N' ]]>
		</if>
		<if test='visitCaseCheck != null and visitCaseCheck != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_PASS WHERE PASS_WAY = '2') ]]>
		</if>
		<if test='menuNo == 100190'>
			<![CDATA[ 	AND LENGTH(A.CENTER_NUMBER) > 0		]]>
		</if>
		<if test='menuNo == 100213'>
			<![CDATA[ 	AND A.CASE_MANAGER = #{loginUserId} ]]>
		</if>
		<if test='menuNo == 100214'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_BOOKMARK WHERE MEMBER_ID = #{loginUserId}) ]]>
		</if>
		<if test='menuNo == 100215'>
			<![CDATA[ 	AND A.CASE_FINISH ='Y']]>
		</if>
		<if test='menuNo == 100254'>
			<![CDATA[ 	AND A.CASE_END ='Y']]>
		</if>
		<if test='victimFrger != null and victimFrger != ""'>
			<![CDATA[ 	AND A.VICTIM_FRGER = #{victimFrger} ]]>
		</if>
		<if test='victimAgeFrom != null and victimAgeFrom != ""'>
			<![CDATA[ 	AND A.VICTIM_AGE >= #{victimAgeFrom} AND VICTIM_AGE <= '120' ]]>
		</if>
		<if test='victimAgeTo != null and victimAgeTo != ""'>
			<![CDATA[ 	AND A.VICTIM_AGE <= #{victimAgeTo} AND VICTIM_AGE <= '120' ]]>
		</if>
		<if test='victimDisable != null and victimDisable != ""'>
			<![CDATA[ 	AND A.VICTIM_DISABLE > 0 ]]>
		</if>
		<if test='victimArea != null and victimArea != ""'>
			<![CDATA[ 	AND A.VICTIM_AREA = #{victimArea}]]>
		</if>
		<if test='attkrFrger != null and attkrFrger != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE 1=1 AND ATTKR_FRGER = #{attkrFrger} )]]>
		</if>
		<if test='attkrAge != null and attkrAge != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE 1=1 AND ATTKR_AGE = #{attkrAge} ) ]]>
		</if>
		<if test='attkrDisable != null and attkrDisable != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE 1=1 AND ATTKR_DISABLE > 0 ) ]]>
		</if>
		<if test='attkrRelGrp != null and attkrRelGrp != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE 1=1 AND ATTKR_REL_GRP = #{attkrRelGrp} ) ]]>
		</if>
		<if test="searchWrd != null and searchWrd != ''">
			<if test='searchCnd == "1"'>
				<![CDATA[	AND A.VICTIM_NAME LIKE CONCAT('%', TRIM(#{searchWrd}), '%')		]]> 
			</if>
			<if test='searchCnd == "2"'>
				<![CDATA[	AND A.CASE_ALIAS LIKE CONCAT('%', TRIM(#{searchWrd}), '%') 		]]>
			</if>
		</if>
		<if test='chkPassWayArr2 != null and chkPassWayArr2 != ""'>
			<![CDATA[ 	AND	B.PASS_WAY IN ]]>
			<foreach collection="chkPassWay" item="code" index="index" separator=", " open="(" close=")">
		        #{code}
		     </foreach>
		</if>
		<if test='chkPassTypeArr2 != null and chkPassTypeArr2 != ""'>
            <![CDATA[   AND B.PASS_TYPE IN ]]>
            <foreach collection="chkPassType" item="code" index="index" separator=", " open="(" close=")">
                #{code}
             </foreach>
        </if>
	</sql>
	
	<sql id="pass-where2">
		<if test='userLevel != "CU" and userLevel != "CA" and userLevel != "ROLE_SUPER"'>
			<if test='scCenterCodeSub != null and scCenterCodeSub != ""'>
				<![CDATA[ 	AND	A.CENTER_CODE = #{scCenterCodeSub} ]]>
			</if>
		</if>
		<choose>
			<when test='centerCodeSub != null and centerCodeSub != ""'>
				<![CDATA[AND A.CENTER_CODE = #{centerCodeSub}]]>
			</when>
			<when test='(centerCode != null and centerCode != "") and centerCode != "XXX"'>
				<![CDATA[AND SUBSTR(A.CENTER_CODE, 1, 1) = #{centerCode}]]>
			</when>
		</choose>
		<!-- <if test='centerCodeSub != null and centerCodeSub != ""'>
			<![CDATA[ 	AND	A.CENTER_CODE = #{centerCodeSub} ]]>
		</if> -->
		<if test='srcCslId != null and srcCslId != ""'>
			<![CDATA[ 	AND	A.MEMBER_ID = #{srcCslId} ]]>
		</if>
		<if test='caseManager != null and caseManager != ""'>
			<![CDATA[ 	AND	A.CASE_MANAGER = #{caseManager} ]]>
		</if>
		<if test='chkCsTypeArr != null and chkCsTypeArr != ""'>
			<![CDATA[ 	AND	A.CASE_TYPE IN ]]>
			<foreach collection="chkCsType" item="code" index="index" separator=", " open="(" close=")">
		        #{code}
		     </foreach>
		</if>
		<if test='chkCsJupsooArr != null and chkCsJupsooArr != ""'>
			<![CDATA[ 	AND	A.CASE_JUPSOO IN ]]>
			<foreach collection="chkCsJupsoo" item="code" index="index" separator=", " open="(" close=")">
		        #{code}
		     </foreach>
		</if>
		<if test='finishCaseCheck != null and finishCaseCheck != ""'>
			<![CDATA[ 	AND A.CASE_FINISH ='N' ]]>
		</if>
		<if test='visitCaseCheck != null and visitCaseCheck != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_PASS WHERE PASS_WAY = '2') ]]>
		</if>
		<if test='menuNo == 100190'>
			<![CDATA[ 	AND LENGTH(A.CENTER_NUMBER) > 0		]]>
		</if>
		<if test='menuNo == 100213'>
			<![CDATA[ 	AND A.CASE_MANAGER = #{loginUserId} ]]>
		</if>
		<if test='menuNo == 100214'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_BOOKMARK WHERE MEMBER_ID = #{loginUserId}) ]]>
		</if>
		<if test='menuNo == 100215'>
			<![CDATA[ 	AND A.CASE_FINISH ='Y']]>
		</if>
		<if test='menuNo == 100254'>
			<![CDATA[ 	AND A.CASE_END ='Y']]>
		</if>
		<if test='victimFrger != null and victimFrger != ""'>
			<![CDATA[ 	AND A.VICTIM_FRGER = #{victimFrger} ]]>
		</if>
		<if test='victimAgeFrom != null and victimAgeFrom != ""'>
			<![CDATA[ 	AND A.VICTIM_AGE >= #{victimAgeFrom} AND VICTIM_AGE <= '120' ]]>
		</if>
		<if test='victimAgeTo != null and victimAgeTo != ""'>
			<![CDATA[ 	AND A.VICTIM_AGE <= #{victimAgeTo} AND VICTIM_AGE <= '120' ]]>
		</if>
		<if test='victimDisable != null and victimDisable != ""'>
			<![CDATA[ 	AND A.VICTIM_DISABLE > 0 ]]>
		</if>
		<if test='victimArea != null and victimArea != ""'>
			<![CDATA[ 	AND A.VICTIM_AREA = #{victimArea}]]>
		</if>
		<if test='attkrFrger != null and attkrFrger != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE 1=1 AND ATTKR_FRGER = #{attkrFrger} )]]>
		</if>
		<if test='attkrAge != null and attkrAge != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE 1=1 AND ATTKR_AGE = #{attkrAge} ) ]]>
		</if>
		<if test='attkrDisable != null and attkrDisable != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE 1=1 AND ATTKR_DISABLE > 0 ) ]]>
		</if>
		<if test='attkrRelGrp != null and attkrRelGrp != ""'>
			<![CDATA[ 	AND A.CASE_SEQ IN ( SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE 1=1 AND ATTKR_REL_GRP = #{attkrRelGrp} ) ]]>
		</if>
		<if test="searchWrd != null and searchWrd != ''">
			<if test='searchCnd == "1"'>
				<![CDATA[	AND A.VICTIM_NAME LIKE CONCAT('%', TRIM(#{searchWrd}), '%')		]]> 
			</if>
			<if test='searchCnd == "2"'>
				<![CDATA[	AND A.CASE_ALIAS LIKE CONCAT('%', TRIM(#{searchWrd}), '%') 		]]>
			</if>
		</if>
		<if test='chkPassWayArr2 != null and chkPassWayArr2 != ""'>
			<![CDATA[ 	AND	B.PASS_WAY IN ]]>
			<foreach collection="chkPassWay" item="code" index="index" separator=", " open="(" close=")">
		        #{code}
		     </foreach>
		</if>
		<if test='chkPassTypeArr2 != null and chkPassTypeArr2 != ""'>
            <![CDATA[   AND B.PASS_TYPE IN ]]>
            <foreach collection="chkPassType" item="code" index="index" separator=", " open="(" close=")">
                #{code}
             </foreach>
        </if>
        <choose>
        	<when test='checkTable != "Y" and checkTable != "C"'>
				<if test='condFrdate != null and condFrdate != ""'>
					<if test='searchDateType == "caseUdate" and searchDateType != null'>
						<![CDATA[   AND DATE_FORMAT(B.PASS_UDATE,'%Y-%m-%d') >= #{condFrdate}     ]]>
					</if>
					<if test='searchDateType == "caseDate" and searchDateType != null'>
						<![CDATA[   AND B.PASS_DATE >= #{condFrdate}     ]]>
					</if>
				</if>
				<if test='condTodate != null and condTodate != ""'>
					<if test='searchDateType == "caseUdate" and searchDateType != null'>
						<![CDATA[   AND DATE_FORMAT(B.PASS_UDATE,'%Y-%m-%d') <= #{condTodate}     ]]>
					</if>
					<if test='searchDateType == "caseDate" and searchDateType != null'>
						<![CDATA[   AND B.PASS_DATE <= #{condTodate}     ]]>
					</if>
				</if>
	         </when>
        	<when test='checkTable == "Y" and checkTable != "C"'>
	        	<if test='condFrdate != null and condFrdate != ""'>
					<if test='searchDateType == "caseUdate" and searchDateType != null'>
						<![CDATA[   AND DATE_FORMAT(A.CASE_UDATE,'%Y-%m-%d') >= #{condFrdate}     ]]>
					</if>
					<if test='searchDateType == "caseDate" and searchDateType != null'>
						<![CDATA[   AND A.CASE_DATE >= #{condFrdate}     ]]>
					</if>
				</if>
				<if test='condTodate != null and condTodate != ""'>
					<if test='searchDateType == "caseUdate" and searchDateType != null'>
						<![CDATA[   AND DATE_FORMAT(A.CASE_UDATE,'%Y-%m-%d') <= #{condTodate}     ]]>
					</if>
					<if test='searchDateType == "caseDate" and searchDateType != null'>
						<![CDATA[   AND A.CASE_DATE <= #{condTodate}     ]]>
					</if>
				</if>
	        </when>
	        <when test='checkTable == "C"'>
            </when>
        </choose>
        
	</sql>
	<!-- passwhere2 end (전체사례리스트 지원서비스 목록에 사용) -->
	
	<sql id="case-order">
		<if test='casePdate == "ASC" and casePdate != null'>
        <![CDATA[
            ORDER BY A.CASE_DATE ASC, A.CASE_TIME ASC, A.CASE_SEQ ASC
            ]]>
        </if>
        <if test='casePdate == "DESC" and casePdate != null'>
        <![CDATA[
            ORDER BY A.CASE_DATE DESC, A.CASE_TIME DESC, A.CASE_SEQ DESC
            ]]>
        </if>
		<if test='casePdate == "UASC" and casePdate != null'>
        <![CDATA[
            ORDER BY A.CASE_UDATE ASC, A.CASE_SEQ DESC
            ]]>
        </if>
        <if test='casePdate == "UDESC" and casePdate != null'>
        <![CDATA[
            ORDER BY A.CASE_UDATE DESC, A.CASE_SEQ DESC
            ]]>
        </if>
        <if test='casePdate == "" or casePdate == null'>
        <![CDATA[
            ORDER BY A.CASE_UDATE DESC, A.CASE_SEQ DESC
            ]]>
        </if>
	</sql>
	
	<!-- 지원서비스 조건 -->
	<sql id="pass-where">
	    <if test='menuNo == 100219'>
		    <choose>
		       <when test='dateType == "PASS"'>
		           <if test='condFrdate != null and condFrdate != ""'>
                       <![CDATA[   AND B.PASS_DATE >= #{condFrdate}     ]]>
                   </if>
                   <if test='condTodate != null and condTodate != ""'>
                       <![CDATA[   AND B.PASS_DATE <= #{condTodate}   ]]>
                   </if>
               </when>
		       <when test='dateType == "UPDATE"'>
		           <if test='condFrdate != null and condFrdate != ""'>
                       <![CDATA[   AND DATE_FORMAT(B.PASS_UDATE,'%Y-%m-%d') >= #{condFrdate}   ]]>
                   </if>
                   <if test='condTodate != null and condTodate != ""'>
                       <![CDATA[   AND DATE_FORMAT(B.PASS_UDATE,'%Y-%m-%d') <= #{condTodate}   ]]>
                   </if>
		       </when>
		       <otherwise>
		           <if test='condFrdate != null and condFrdate != ""'>
	                   <![CDATA[   AND B.PASS_DATE >= #{condFrdate}     ]]>
	               </if>
	               <if test='condTodate != null and condTodate != ""'>
	                   <![CDATA[   AND B.PASS_DATE <= #{condTodate}   ]]>
	               </if>
		       </otherwise>
		    </choose>
        </if>
		<if test='shPassType != null and shPassType != ""'>
			<![CDATA[ 	AND	B.PASS_TYPE = #{shPassType} ]]>
		</if>
		<if test='shSub1Data != null and shSub1Data != ""'>
			<![CDATA[ 	AND	B.SUB1_DATA = #{shSub1Data} ]]>
		</if>
		<if test='shSub2Data != null and shSub2Data != ""'>
            <![CDATA[   AND B.SUB2_DATA = #{shSub2Data} ]]>
        </if>
		<!-- 
		<if test='condFrdate != null and condFrdate != ""'>
			<![CDATA[   AND A.PASS_DATE >= #{condFrdate}     ]]>
		</if>
		<if test='condTodate != null and condTodate != ""'>
			<![CDATA[   AND A.PASS_DATE <= #{condTodate}   ]]>
		</if>
		-->
		<if test='srcCslId != null and srcCslId != ""'>
			<![CDATA[ 	AND	B.PASS_MANAGER = #{srcCslId} ]]>
		</if>
	</sql>
	
	<sql id="pass-order">
		<if test='passPdate == "ASC" and passPdate != null'>
        <![CDATA[
            ORDER BY B.PASS_DATE ASC, B.PASS_TIME ASC, B.PASS_SEQ ASC
            ]]>
        </if>
        <if test='passPdate == "DESC" and passPdate != null'>
        <![CDATA[
            ORDER BY B.PASS_DATE DESC, B.PASS_TIME DESC, B.PASS_SEQ DESC
            ]]>
        </if>
        <if test='passUdate == "DESC" and passUdate != null'>
        <![CDATA[
            ORDER BY B.PASS_UDATE DESC, B.PASS_SEQ DESC
            ]]>
        </if>
        <if test='passUdate == "ASC" and passUdate != null'>
        <![CDATA[
            ORDER BY B.PASS_UDATE ASC, B.PASS_SEQ ASC
            ]]>
        </if>
        <if test='passPdate == "" or passPdate == null'>
	        <if test='passUdate == "" or passUdate == null'>
	        <![CDATA[
	            ORDER BY B.PASS_UDATE DESC, B.PASS_SEQ DESC
	        ]]>
	        </if>
        </if>
	</sql>

	<!-- 사례 전체count수 -->
	<select id="countCase" parameterType="zvl" resultType="long">
		<![CDATA[
		/*  countCase */
		SELECT COUNT(*) AS totcnt
		  FROM TA_CASE A
		 WHERE A.CASE_DELETED = 'N' 
		]]>
		<include refid="case-where" />
	</select>

	<!-- 사례 목록 -->
	<select id="findAllCase" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/*  findAllCase */
		SELECT A.CASE_SEQ, A.CASE_NUMBER, A.CASE_REL, A.CENTER_CODE
				, A.MEMBER_ID
				, FU_GETUSER_NM(A.MEMBER_ID) AS MEMBER_NAME
		        , A.CASE_DATE, A.CASE_TIME
		        , A.CASE_JUPSOO
		        , FN_GET_CODE_NAME('CS20', A.CASE_JUPSOO) AS CASE_JUPSOO_NM, A.CASE_TYPE_MEMO
		        , A.VICTIM_NAME, A.VICTIM_AGE, ECL_DECRYPT(A.VICTIM_BIRTH) AS VICTIM_BIRTH, A.VICTIM_FRGER, A.VICTIM_DISABLE, ECL_DECRYPT(A.CLIENT) AS CLIENT
		        , A.CLIENT_REL_GRP, A.CLIENT_REL
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CS24G', A.CLIENT_REL_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CS24', A.CLIENT_REL),'')) AS CLIENT_REL_NM, A.CLIENT_REL_MEMO
		        , A.DMG_TIME, A.DMG_TIME_MEMO
		        , FN_GET_CODE_NAME('CM05', A.CENTER_CODE) AS CENTER_NAME
		        , A.CASE_TYPE
		        , FN_GET_CODE_NAME('CSAB', A.CASE_TYPE) AS CASE_TYPE_NM
		        , A.CASE_TYPE_GRP, A.CASE_TYPE_SUB
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CSACG', A.CASE_TYPE_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CSAC', A.CASE_TYPE_SUB),'')) AS CASE_TYPE_SUB_NM
		        , A.VICTIM_SEX, A.CASE_FINISH, A.CASE_END
		        , FN_GET_CODE_NAME('HM46', A.VICTIM_AREA) AS VICTIM_AREA_NM
		        , FN_GET_CODE_NAME('HM47', A.VICTIM_AREA_SUB) AS VICTIM_AREA_SUB_NM
		        , A.VICTIM_AREA
		        , A.VICTIM_AREA_SUB
		        , ECL_DECRYPT(A.VICTIM_AREA_MEMO) as VICTIM_AREA_MEMO
		        , A.CASE_ROUTE_GRP, A.CASE_ROUTE
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CSRTG', A.CASE_ROUTE_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CSRT', A.CASE_ROUTE),'')) AS CASE_ROUTE_NM
		        , A.DMG_STATE_YN, A.DMG_STATE, A.CASE_HELP, A.CASE_HELP_MEMO, A.CASE_MANAGER
		        , FU_GETUSER_NM(A.CASE_MANAGER) AS CASE_MANAGER_NM
		        , A.CASE_DELETED
		        , FN_GET_CODE_NAME('CDFR', A.VICTIM_FRGER) AS VICTIM_FRGER_NM
		        , A.VICTIM_FRGER_MEMO
		        , FN_GET_CODE_NAME('CDDA', A.VICTIM_DISABLE) AS VICTIM_DISABLE_NM
		        , A.VICTIM_DISABLE_MEMO
		        , A.CASE_ATTKR_SEQ
		        , A.CENTER_NUMBER
		        , A.ERYY_CNSLTNT
				, A.CASE_ALIAS
				, A.CASE_UDATE
        FROM (SELECT * 
				FROM TA_CASE A 
                WHERE A.CASE_DELETED = 'N' 
	 	]]>
			<include refid="case-where" />
	 		<include refid="case-order" />
		<![CDATA[
          ) A
		]]>
 		<include refid="case-order" />
		<![CDATA[
		limit #{firstIndex}, #{recordCountPerPage}
		]]>
	</select>
	
	<!-- 우리사례 전체count수 -->
	<select id="countCaseCneter" parameterType="zvl" resultType="long">
		<![CDATA[
		/*  countCaseCneter */
		SELECT COUNT(*) AS totcnt
		  FROM TA_CASE A
		 WHERE A.CASE_DELETED = 'N' 
		]]>
		<include refid="case-where" />
		<if test='searchMasterText != null and searchMasterText != ""'>
			<if test='searchCaseType=="victimName"'>
				<![CDATA[ 	AND A.VICTIM_NAME LIKE CONCAT('%', #{searchMasterText}, '%')  ]]>
			</if>
			<if test='searchCaseType=="clientName"'>
                <![CDATA[   AND A.CLIENT LIKE CONCAT('%', ECL_ENCRYPT(#{searchMasterText}), '%')  ]]>
            </if>
			<if test='searchCaseType=="caseAlias" '>
				<![CDATA[ 	AND A.CASE_ALIAS LIKE CONCAT('%', TRIM(#{searchMasterText}), '%')  ]]>
			</if>
			<if test='searchCaseType=="victimBirth"'>
				<![CDATA[	AND A.VICTIM_BIRTH = ECL_ENCRYPT(#{searchMasterText}) ]]>
			</if>
			<if test='searchCaseType=="victimMemo"'>
				<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_CASE_MEMO WHERE VICTIM_MEMO LIKE CONCAT('%', #{searchMasterText}, '%')) ]]>
			</if>
			<if test='searchCaseType=="attkrMemo"'>
				<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE ATTKR_MEMO LIKE CONCAT('%', #{searchMasterText}, '%')) ]]>
			</if>
			<if test='searchCaseType=="ccName"'>
				<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_CASE_CONTACT WHERE CC_NAME like CONCAT('%', #{searchMasterText}, '%') OR CC_PHONE like CONCAT('%', #{searchMasterText}, '%')) ]]>
			</if>
			<if test='searchCaseType=="userName"'>
				<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_PASS WHERE ECL_DECRYPT(USER_NAME) LIKE CONCAT('%', #{searchMasterText}, '%')) ]]>
			</if>
			<if test='searchCaseType=="caseNumber"'>
				<![CDATA[ 	AND A.CASE_NUMBER LIKE CONCAT('%', #{searchMasterText}, '%') ]]>
			</if>
		</if>
		<if test='userLevel != "CU" and userLevel != "CA" and userLevel != "ROLE_SUPER"'>
			<if test='scCenterCodeSub != null and scCenterCodeSub != ""'>
				<![CDATA[ 	AND	A.CENTER_CODE = #{scCenterCodeSub} ]]>
			</if>
		</if>
	</select>

	<!-- 우리 사례 목록 -->
	<select id="findAllCaseCneter" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/*  findAllCaseCneter */
		SELECT A.CASE_SEQ, A.CASE_NUMBER, A.CASE_REL, A.CENTER_CODE
				, A.MEMBER_ID
				, FU_GETUSER_NM(A.MEMBER_ID) AS MEMBER_NAME
		        , A.CASE_DATE, A.CASE_TIME
		        , A.CASE_JUPSOO
		        , FN_GET_CODE_NAME('CS20', A.CASE_JUPSOO) AS CASE_JUPSOO_NM, A.CASE_TYPE_MEMO
		        , A.VICTIM_NAME, A.VICTIM_AGE, ECL_DECRYPT(A.VICTIM_BIRTH) AS VICTIM_BIRTH, A.VICTIM_FRGER, A.VICTIM_DISABLE, ECL_DECRYPT(A.CLIENT) AS CLIENT
		        , A.CLIENT_REL_GRP, A.CLIENT_REL
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CS24G', A.CLIENT_REL_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CS24', A.CLIENT_REL),'')) AS CLIENT_REL_NM, A.CLIENT_REL_MEMO
		        , A.DMG_TIME, A.DMG_TIME_MEMO
		        , FN_GET_CODE_NAME('CM05', A.CENTER_CODE) AS CENTER_NAME
		        , A.CASE_TYPE
		        , FN_GET_CODE_NAME('CSAB', A.CASE_TYPE) AS CASE_TYPE_NM
		        , A.CASE_TYPE_GRP, A.CASE_TYPE_SUB
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CSACG', A.CASE_TYPE_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CSAC', A.CASE_TYPE_SUB),'')) AS CASE_TYPE_SUB_NM
		        , A.VICTIM_SEX, A.CASE_FINISH, A.CASE_END
		        , FN_GET_CODE_NAME('HM46', A.VICTIM_AREA) AS VICTIM_AREA_NM
		        , FN_GET_CODE_NAME('HM47', A.VICTIM_AREA_SUB) AS VICTIM_AREA_SUB_NM
		        , A.VICTIM_AREA
		        , A.VICTIM_AREA_SUB
		        , ECL_DECRYPT(A.VICTIM_AREA_MEMO) as VICTIM_AREA_MEMO
		        , A.CASE_ROUTE_GRP, A.CASE_ROUTE
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CSRTG', A.CASE_ROUTE_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CSRT', A.CASE_ROUTE),'')) AS CASE_ROUTE_NM
		        , A.DMG_STATE_YN, A.DMG_STATE, A.CASE_HELP, A.CASE_HELP_MEMO, A.CASE_MANAGER
		        , A.CASE_DELETED
		        , FN_GET_CODE_NAME('CDFR', A.VICTIM_FRGER) AS VICTIM_FRGER_NM
		        , A.VICTIM_FRGER_MEMO
		        , FN_GET_CODE_NAME('CDDA', A.VICTIM_DISABLE) AS VICTIM_DISABLE_NM
		        , A.VICTIM_DISABLE_MEMO
		        , A.CASE_ATTKR_SEQ
		        , A.CENTER_NUMBER
		        , A.ERYY_CNSLTNT
				, A.CASE_ALIAS
				, A.CASE_UDATE
				, FU_GETUSER_NM(A.CASE_MANAGER) AS CASE_MANAGER_NM
        FROM (SELECT * 
				FROM TA_CASE A 
                WHERE A.CASE_DELETED = 'N' 
	 	]]>
	 	<include refid="case-where" />
			<if test='searchMasterText != null and searchMasterText != ""'>
				<if test='searchCaseType=="victimName"'>
					<![CDATA[ 	AND A.VICTIM_NAME LIKE CONCAT('%', #{searchMasterText}, '%')  ]]>
				</if>
				<if test='searchCaseType=="clientName"'>
	                <![CDATA[   AND A.CLIENT LIKE CONCAT('%', ECL_ENCRYPT(#{searchMasterText}), '%')  ]]>
	            </if>
				<if test='searchCaseType=="caseAlias" '>
					<![CDATA[ 	AND A.CASE_ALIAS LIKE CONCAT('%', TRIM(#{searchMasterText}), '%')  ]]>
				</if>
				<if test='searchCaseType=="victimBirth"'>
					<![CDATA[ 	AND A.VICTIM_BIRTH = ECL_ENCRYPT(#{searchMasterText}) ]]>
				</if>
				<if test='searchCaseType=="victimMemo"'>
					<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_CASE_MEMO WHERE VICTIM_MEMO LIKE CONCAT('%', #{searchMasterText}, '%')) ]]>
				</if>
				<if test='searchCaseType=="attkrMemo"'>
					<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_CASE_ATTKR WHERE ATTKR_MEMO LIKE CONCAT('%', #{searchMasterText}, '%')) ]]>
				</if>
				<if test='searchCaseType=="ccName"'>
					<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_CASE_CONTACT WHERE CC_NAME like CONCAT('%', #{searchMasterText}, '%') OR CC_PHONE like CONCAT('%', #{searchMasterText}, '%')) ]]>
				</if>
				<if test='searchCaseType=="userName"'>
					<![CDATA[ 	AND A.CASE_SEQ IN (SELECT CASE_SEQ FROM TA_PASS WHERE ECL_DECRYPT(USER_NAME) LIKE CONCAT('%', #{searchMasterText}, '%')) ]]>
				</if>
				<if test='searchCaseType=="caseNumber"'>
					<![CDATA[ 	AND A.CASE_NUMBER LIKE CONCAT('%', #{searchMasterText}, '%') ]]>
				</if>
			</if>
			<if test='userLevel != "CU" and userLevel != "CA" and userLevel != "ROLE_SUPER"'>
				<if test='scCenterCodeSub != null and scCenterCodeSub != ""'>
					<![CDATA[ 	AND	A.CENTER_CODE = #{scCenterCodeSub} ]]>
				</if>
			</if>
	 		<include refid="case-order" />
		<![CDATA[
          ) A
		]]>
 		<include refid="case-order" />
		<![CDATA[
		limit #{firstIndex}, #{recordCountPerPage}
		]]>
	</select>
	
	<!-- 타센터 접수 여부 검색 전체count수 -->
	<select id="countCaselistOther" parameterType="zvl" resultType="long">
		<![CDATA[
		/*  countCaselistOther */
		SELECT COUNT(*) AS totcnt
		  FROM TA_CASE A
		 WHERE A.CASE_DELETED = 'N' 
		   AND A.CENTER_CODE <> #{nCenterCodeSub} 
		]]>
		<choose>
			<when test='scVictimName != null and scVictimName != ""'>
				<![CDATA[
				   AND A.VICTIM_NAME LIKE CONCAT('%', #{scVictimName}, '%')
			 	]]>
			</when>
			<otherwise>
				<![CDATA[
				   AND A.VICTIM_NAME LIKE CONCAT('%', null, '%')
			 	]]>
			</otherwise>
		</choose>
	</select>

	<!-- 타센터 접수 여부 검색 목록 -->
	<select id="findCaselistOther" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/*  findCaselistOther */
		SELECT A.CASE_SEQ, A.CASE_NUMBER, A.CASE_REL, A.CENTER_CODE
				, A.MEMBER_ID
				, FU_GETUSER_NM(A.MEMBER_ID) AS MEMBER_NAME
		        , A.CASE_DATE, A.CASE_TIME
		        , A.CASE_JUPSOO
		        , FN_GET_CODE_NAME('CS20', A.CASE_JUPSOO) AS CASE_JUPSOO_NM, A.CASE_TYPE_MEMO
		        , A.VICTIM_NAME, A.VICTIM_AGE, ECL_DECRYPT(A.VICTIM_BIRTH) AS VICTIM_BIRTH, A.VICTIM_FRGER, A.VICTIM_DISABLE, ECL_DECRYPT(A.CLIENT) AS CLIENT
		        , A.CLIENT_REL_GRP, A.CLIENT_REL
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CS24G', A.CLIENT_REL_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CS24', A.CLIENT_REL),'')) AS CLIENT_REL_NM, A.CLIENT_REL_MEMO
		        , A.DMG_TIME, A.DMG_TIME_MEMO
		        , FN_GET_CODE_NAME('CM05', A.CENTER_CODE) AS CENTER_NAME
		        , A.CASE_TYPE
		        , FN_GET_CODE_NAME('CSAB', A.CASE_TYPE) AS CASE_TYPE_NM
		        , A.CASE_TYPE_GRP, A.CASE_TYPE_SUB
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CSACG', A.CASE_TYPE_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CSAC', A.CASE_TYPE_SUB),'')) AS CASE_TYPE_SUB_NM
		        , A.VICTIM_SEX, A.CASE_FINISH, A.CASE_END
		        , FN_GET_CODE_NAME('HM46', A.VICTIM_AREA) AS VICTIM_AREA_NM
		        , FN_GET_CODE_NAME('HM47', A.VICTIM_AREA_SUB) AS VICTIM_AREA_SUB_NM
		        , A.VICTIM_AREA
		        , A.VICTIM_AREA_SUB
		        , ECL_DECRYPT(A.VICTIM_AREA_MEMO) as VICTIM_AREA_MEMO
		        , A.CASE_ROUTE_GRP, A.CASE_ROUTE
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CSRTG', A.CASE_ROUTE_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CSRT', A.CASE_ROUTE),'')) AS CASE_ROUTE_NM
		        , A.DMG_STATE_YN, A.DMG_STATE, A.CASE_HELP, A.CASE_HELP_MEMO, A.CASE_MANAGER
		        , A.CASE_DELETED
		        , FN_GET_CODE_NAME('CDFR', A.VICTIM_FRGER) AS VICTIM_FRGER_NM
		        , A.VICTIM_FRGER_MEMO
		        , FN_GET_CODE_NAME('CDDA', A.VICTIM_DISABLE) AS VICTIM_DISABLE_NM
		        , A.VICTIM_DISABLE_MEMO
		        , A.CASE_ATTKR_SEQ
		        , A.CENTER_NUMBER
		        , A.ERYY_CNSLTNT
				, A.CASE_ALIAS
        FROM TA_CASE A
		 WHERE A.CASE_DELETED = 'N' 
		   AND A.CENTER_CODE <> #{nCenterCodeSub} 
		]]>
		<choose>
			<when test='scVictimName != null and scVictimName != ""'>
				<![CDATA[
				   AND A.VICTIM_NAME LIKE CONCAT('%', #{scVictimName}, '%')
			 	]]>
			</when>
			<otherwise>
				<![CDATA[
				   AND A.VICTIM_NAME LIKE CONCAT('%', null, '%')
			 	]]>
			</otherwise>
		</choose>
		<include refid="case-order" />
		<![CDATA[
		limit #{firstIndex}, #{recordCountPerPage}
		]]>
	</select>
	
	<!-- 사례 목록 -->
    <select id="findCaseList" parameterType="zvl" resultType="zvl">
        <![CDATA[
        /*  findCaseList */
        SELECT a.*
          FROM TA_CASE A
         WHERE A.CASE_DELETED = 'N' 
        ORDER BY CASE_SEQ DESC
        ]]>
    </select>

	<!-- 사례 상세 -->
	<select id="findOneCase" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findOneCase */
		SELECT A.CASE_SEQ, A.CASE_NUMBER, A.CASE_REL, A.CENTER_CODE
				, A.MEMBER_ID
				, FU_GETUSER_NM(A.MEMBER_ID) AS MEMBER_NAME
		        , A.CASE_DATE, A.CASE_TIME
		        , A.CASE_JUPSOO
		        , FN_GET_CODE_NAME('CS20', A.CASE_JUPSOO) AS CASE_JUPSOO_NM, A.CASE_TYPE_MEMO
		        , A.VICTIM_NAME, A.VICTIM_AGE, ECL_DECRYPT(A.VICTIM_BIRTH) AS VICTIM_BIRTH, A.VICTIM_FRGER, A.VICTIM_DISABLE, ECL_DECRYPT(A.CLIENT) AS CLIENT
		        , A.CLIENT_REL_GRP, A.CLIENT_REL
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CS24G', A.CLIENT_REL_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CS24', A.CLIENT_REL),'')) AS CLIENT_REL_NM, A.CLIENT_REL_MEMO
		        , A.DMG_TIME, A.DMG_TIME_MEMO
		        , FN_GET_CODE_NAME('CM05', A.CENTER_CODE) AS CENTER_NAME
		        , A.CASE_TYPE
		        , FN_GET_CODE_NAME('CSAB', A.CASE_TYPE) AS CASE_TYPE_NM
		        , A.CASE_TYPE_GRP, A.CASE_TYPE_SUB
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CSACG', A.CASE_TYPE_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CSAC', A.CASE_TYPE_SUB),'')) AS CASE_TYPE_SUB_NM
		        , A.VICTIM_SEX, A.CASE_FINISH, A.CASE_END
		        , FN_GET_CODE_NAME('HM46', A.VICTIM_AREA) AS VICTIM_AREA_NM
		        , FN_GET_CODE_NAME('HM47', A.VICTIM_AREA_SUB) AS VICTIM_AREA_SUB_NM
		        , A.VICTIM_AREA
		        , A.VICTIM_AREA_SUB
		        , ECL_DECRYPT(A.VICTIM_AREA_MEMO) as VICTIM_AREA_MEMO
		        , A.CASE_ROUTE_GRP, A.CASE_ROUTE
		        , CONCAT(IFNULL(FN_GET_CODE_NAME('CSRTG', A.CASE_ROUTE_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CSRT', A.CASE_ROUTE),'')) AS CASE_ROUTE_NM
		        , A.DMG_STATE_YN, A.DMG_STATE, A.CASE_HELP, A.CASE_HELP_MEMO, A.CASE_MANAGER
		        , FU_GETUSER_NM(A.CASE_MANAGER) AS CASE_MANAGER_NM
		        , A.CASE_DELETED
		        , FN_GET_CODE_NAME('CDFR', A.VICTIM_FRGER) AS VICTIM_FRGER_NM
		        , A.VICTIM_FRGER_MEMO
		        , FN_GET_CODE_NAME('CDDA', A.VICTIM_DISABLE) AS VICTIM_DISABLE_NM
		        , A.VICTIM_DISABLE_MEMO
		        , A.CASE_ATTKR_SEQ
		        , A.CENTER_NUMBER
		        , A.ERYY_CNSLTNT
				, A.CASE_ALIAS
				, CONCAT(A.CASE_SEQ) CASE_SEQ_C
        FROM TA_CASE A
		WHERE CASE_SEQ = #{caseSeq}
		]]>
	</select>
	
	<select id="findOneUpdateCase" parameterType="zvl" resultType="zvl">
	<![CDATA[
	/* findOneUpdateCase */
	SELECT	C.CASE_SEQ,CASE_NUMBER,CENTER_NUMBER,CASE_REL,CENTER_CODE,MEMBER_ID
			, VICTIM_NAME,VICTIM_AGE,ECL_DECRYPT(VICTIM_BIRTH) AS VICTIM_BIRTH,VICTIM_FRGER,VICTIM_FRGER_MEMO,VICTIM_DISABLE,VICTIM_DISABLE_MEMO
			, VICTIM_AREA, VICTIM_AREA_SUB, ECL_DECRYPT(VICTIM_AREA_MEMO) AS VICTIM_AREA_MEMO
			, ECL_DECRYPT(CLIENT) AS CLIENT, CLIENT_REL_GRP, CLIENT_REL_MEMO, CASE_ROUTE_GRP,CASE_ROUTE, DMG_TIME, DMG_TIME_MEMO, DMG_STATE, DMG_STATE_YN
			, CONCAT(FN_GET_CODE_NAME('CDDA', VICTIM_DISABLE), ' ', (CASE VICTIM_DISABLE WHEN 1 THEN CONCAT(VICTIM_DISABLE_MEMO,'급') WHEN 2 THEN CONCAT('(', VICTIM_DISABLE_MEMO, ')') ELSE '' END )) AS VICTIM_DISABLE_NM 
			, CASE_TYPE,CASE_TYPE_GRP,CASE_TYPE_SUB,CASE_DATE,CASE_TIME,CASE_TIME_E,CASE_HELP,CASE_HELP_MEMO
			, FN_GET_CODE_NAME('CS20', CASE_JUPSOO) AS CASE_JUPSOO, CASE_TYPE_MEMO
			, CONCAT(FN_GET_CODE_NAME('CS24G', CLIENT_REL_GRP), ' ', FN_GET_CODE_NAME('CS24', CLIENT_REL)) AS CLIENT_REL
			, CONCAT(FN_GET_CODE_NAME('CDFR', VICTIM_FRGER), ' ', (CASE VICTIM_FRGER WHEN 'Y' THEN CONCAT('(', VICTIM_FRGER_MEMO, ')') ELSE '' END)) AS VICTIM_FRGER_NM
			, (CASE VICTIM_SEX WHEN 'M' THEN '남자' WHEN 'F' THEN '여자' ELSE '알수없음' END) AS VICTIM_SEX_NM
			, FN_GET_CODE_NAME('HM46', VICTIM_AREA) AS VICTIM_AREA_NM
			, FN_GET_CODE_NAME('HM47', VICTIM_AREA_SUB) AS VICTIM_AREA_SUB_NM
			, ECL_DECRYPT(VICTIM_AREA_MEMO) AS VICTIM_AREA_MEMO
			, CONCAT(FN_GET_CODE_NAME('CSRTG', CASE_ROUTE_GRP), ' ', FN_GET_CODE_NAME('CSRT', CASE_ROUTE)) AS CASE_ROUTE_NM
			, FN_GET_CODE_NAME('CSAB', CASE_TYPE) AS CASE_TYPE_NM
			, (CASE DMG_STATE_YN WHEN 'N' THEN '없음' WHEN 'Y' THEN '있음' WHEN 'X' THEN '알수없음' ELSE '' END) AS DMG_STATE_YN_NM
			, CONCAT(FN_GET_CODE_NAME('CSACG', CASE_TYPE_GRP), ' ', IFNULL(FN_GET_CODE_NAME('CSAC', CASE_TYPE_SUB),'')) AS CASE_TYPE_SUB_NM
			, FN_GET_CODE_NAME('CM05', CENTER_CODE) AS CENTER_NAME
			, FU_GETUSER_NM(MEMBER_ID) AS MEMBER_NAME
			, CASE_MANAGER
	FROM	TA_CASE C
	WHERE	C.case_seq=#{caseSeq}
	]]>
	</select>
	
	<!-- 가해자 정보 상세 리스트 -->
	<select id="findCaseAttkrList" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCaseAttkrList */
		SELECT ATTKR_SEQ,CASE_SEQ
            , FN_GET_CODE_NAME('MF', ATTKR_SEX) as ATTKR_SEX_NM, ATTKR_SEX
            , FN_GET_CODE_NAME('ATAG', ATTKR_AGE) as ATTKR_AGE_NM, ATTKR_AGE
            , FN_GET_CODE_NAME('CDFR', ATTKR_FRGER) as ATTKR_FRGER_NM, ATTKR_FRGER
            , FN_GET_CODE_NAME('CDDA', ATTKR_DISABLE) as ATTKR_DISABLE_NM, ATTKR_DISABLE
            , CONCAT(IFNULL(FN_GET_CODE_NAME('CZ01G', ATTKR_REL_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CZ01', ATTKR_REL),'')) AS ATTKR_REL_NM
            , ATTKR_REL_GRP, ATTKR_REL
            , ATTKR_REL_MEMO
            , ATTKR_STATE_YN, ATTKR_STATE
            , ATTKR_MEMO
            , ATTKR_DISABLE_MEMO
			, ATTKR_FRGER_MEMO
		  FROM TA_CASE_ATTKR 
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</select>

	<!-- 가해자 정보 상세 -->
	<select id="findCaseAttkrOne" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCaseAttkrOne */
		SELECT ATTKR_SEQ,CASE_SEQ
            , FN_GET_CODE_NAME('MF', ATTKR_SEX) as ATTKR_SEX_NM, ATTKR_SEX
            , FN_GET_CODE_NAME('ATAG', ATTKR_AGE) as ATTKR_AGE_NM, ATTKR_AGE
            , FN_GET_CODE_NAME('CDFR', ATTKR_FRGER) as ATTKR_FRGER_NM, ATTKR_FRGER
            , FN_GET_CODE_NAME('CDDA', ATTKR_DISABLE) as ATTKR_DISABLE_NM, FORMAT(ATTKR_DISABLE,'#')AS ATTKR_DISABLE
            , CONCAT(IFNULL(FN_GET_CODE_NAME('CZ01G', ATTKR_REL_GRP),''),' ', IFNULL(FN_GET_CODE_NAME('CZ01', ATTKR_REL),'')) AS ATTKR_REL_NM
            , ATTKR_REL_GRP, ATTKR_REL
            , ATTKR_REL_MEMO
            , ATTKR_STATE_YN, ATTKR_STATE
            , ATTKR_MEMO
            , ATTKR_DISABLE_MEMO
			, ATTKR_FRGER_MEMO
		  FROM TA_CASE_ATTKR 
		 WHERE CASE_SEQ = #{caseSeq}
		 AND ATTKR_SEQ = #{attkrSeq}
		]]>
	</select>
	
	<!-- 가해자 정보 SEQ -->
	<select id="findCaseAttkrSeq" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCaseAttkrSeq */
		SELECT IFNULL(MAX(ATTKR_SEQ),0)+1 AS ATTKR_SEQ  FROM TA_CASE_ATTKR
		]]>
	</select>
	
	<!-- 사례 등록 -->
    <insert id="saveCase" parameterType="zvl">
		<selectKey resultType="Integer" order="BEFORE" keyProperty="caseSeq">
			SELECT IFNULL(MAX(CASE_SEQ),0)+1 AS CASE_SEQ  FROM TA_CASE
		</selectKey>
		<![CDATA[
		/* saveCase */
		INSERT INTO TA_CASE (
			CASE_SEQ, CASE_NUMBER, CENTER_NUMBER, CASE_REL, CASE_REL_SEQ, CENTER_CODE, MEMBER_ID
	     , CASE_TYPE, CASE_TYPE_GRP, CASE_TYPE_SUB, CASE_DATE, CASE_TIME,CASE_TIME_E,CASE_JUPSOO,CASE_TYPE_MEMO,CASE_VISIT 
	     , VICTIM_NAME,VICTIM_SEX,VICTIM_AGE,VICTIM_BIRTH, VICTIM_FRGER, VICTIM_FRGER_MEMO, VICTIM_DISABLE,VICTIM_DISABLE_MEMO 
	     , CLIENT,CLIENT_REL_GRP,CLIENT_REL,CLIENT_REL_MEMO 
	     , CASE_ROUTE_GRP, CASE_ROUTE, CASE_HELP, CASE_HELP_MEMO 
	     , DMG_TIME, DMG_TIME_MEMO, DMG_STATE, DMG_STATE_YN, VICTIM_AREA, VICTIM_AREA_SUB, VICTIM_AREA_MEMO, CASE_MANAGER, CASE_ATTKR_SEQ 
	     , ERYY_CNSLTNT, CASE_ALIAS
		       ) VALUES (
		 #{caseSeq}, #{caseNumber},#{centerNumber},#{caseRel2},#{caseRelSeq},#{centerCode},#{memberId} 
		, #{caseType}, #{caseTypeGrp}, #{caseTypeSub}, #{caseDate}, #{caseTime}, #{caseTimeE}, #{caseJupsoo}, #{caseTypeMemo}, #{caseVisit}
		, #{victimName}, #{victimSex}, #{victimAge}, ecl_encrypt(#{victimBirth}), #{victimFrger}, #{victimFrgerMemo}, #{victimDisable}, #{victimDisableMemo} 
		, ecl_encrypt(#{client}), #{clientRelGrp}, #{clientRel}, #{clientRelMemo} 
		, #{caseRouteGrp}, #{caseRoute}, #{caseHelp2}, #{caseHelpMemo} 
		, #{dmgTime}, #{dmgTimeMemo}, #{dmgState2}, #{dmgStateYn}, #{victimArea}, #{victimAreaSub}, ecl_encrypt(#{victimAreaMemo}), #{caseManager}, #{attkrSeq}
		, #{eryyCnsltnt}, #{caseAlias}
		       )
		]]>
	</insert>

	<!-- 사례 수정 -->
	<update id="updateCase" parameterType="zvl">
		<![CDATA[
		/* updateCase */
		UPDATE TA_CASE SET 
			  CASE_NUMBER = #{caseNumber}
			, CENTER_NUMBER = #{centerNumber}
			, CASE_REL = #{caseRel2}
			, CASE_REL_SEQ = #{caseRelSeq}
			, CENTER_CODE = #{centerCode}
			, CASE_TYPE = #{caseType}
			, CASE_TYPE_GRP = #{caseTypeGrp}
			, CASE_TYPE_SUB = #{caseTypeSub}
			, CASE_DATE = #{caseDate}
			, CASE_TIME = #{caseTime}
			, CASE_TIME_E = #{caseTimeE}
			, CASE_JUPSOO = #{caseJupsoo}
			, CASE_TYPE_MEMO = #{caseTypeMemo}
			, CASE_VISIT  = #{caseVisit}
			, VICTIM_NAME = #{victimName}
			, VICTIM_SEX = #{victimSex}
			, VICTIM_AGE = #{victimAge}
			, VICTIM_BIRTH = ecl_encrypt(#{victimBirth})
			, VICTIM_FRGER = #{victimFrger}
			, VICTIM_FRGER_MEMO = #{victimFrgerMemo}
			, VICTIM_DISABLE = #{victimDisable}
			, VICTIM_DISABLE_MEMO  = #{victimDisableMemo} 
			, CLIENT = ecl_encrypt(#{client})
			, CLIENT_REL_GRP = #{clientRelGrp}
			, CLIENT_REL = #{clientRel}
			, CLIENT_REL_MEMO  = #{clientRelMemo} 
			, CASE_ROUTE_GRP = #{caseRouteGrp}
			, CASE_ROUTE = #{caseRoute}
			, CASE_HELP = #{caseHelp2}
			, CASE_HELP_MEMO  = #{caseHelpMemo} 
			, DMG_TIME = #{dmgTime}
			, DMG_TIME_MEMO = #{dmgTimeMemo}
			, DMG_STATE = #{dmgState2}
			, DMG_STATE_YN = #{dmgStateYn}
			, VICTIM_AREA = #{victimArea}
			, VICTIM_AREA_SUB = #{victimAreaSub}
			, VICTIM_AREA_MEMO = ecl_encrypt(#{victimAreaMemo})
			, CASE_MANAGER = #{caseManager}
			, CASE_ATTKR_SEQ  = #{caseAttkrSeq}
			, ERYY_CNSLTNT  = #{eryyCnsltnt}
			, CASE_ALIAS  = #{caseAlias}
			, CASE_UDATE = NOW()
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</update>
	
	<!-- 사례 삭제 -->
	<delete id="deleteCase" parameterType="zvl">
		<![CDATA[
		/* deleteCase */
		UPDATE TA_CASE
		SET CASE_DELETED ='Y'
		  , CASE_UDATE  = NOW()
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</delete>
	
	<!-- 가해자정보 삭제 -->
	<delete id="deleteAttkr" parameterType="zvl">
		<![CDATA[
		/* deleteAttkr */
		DELETE
		  FROM TA_CASE_ATTKR
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</delete>
	
	<!-- 메모 등록 -->
    <insert id="saveMemo" parameterType="zvl">
		<![CDATA[
		/* saveMemo */
		INSERT INTO TA_CASE_MEMO ( CASE_SEQ, JUPSOO_MEMO, VICTIM_MEMO, CASE_MEMO, SANGDAM_MEMO, ETC_MEMO
         ) VALUES (
                    #{caseSeq}, #{jupsooMemo}, #{victimMemo}, #{caseMemo}, #{sangdamMemo}, #{etcMemo}
                    ) 
		]]>
	</insert>
	
	<!-- 메모 수정 -->
	<update id="updateMemo" parameterType="zvl">
		<![CDATA[
		/* "updateMemo" */
		UPDATE TA_CASE_MEMO SET 
			  JUPSOO_MEMO = #{jupsooMemo}
			, VICTIM_MEMO = #{victimMemo}
			, CASE_MEMO = #{caseMemo}
			, SANGDAM_MEMO = #{sangdamMemo}
			, ETC_MEMO = #{etcMemo}
		 WHERE CASE_SEQ = #{caseSeq} 
		]]>
	</update>
	
	<!-- 메모 상세조회 -->
	<select id="findOneMemo" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findOneMemo */
		SELECT CASE_SEQ, JUPSOO_MEMO, VICTIM_MEMO, CASE_MEMO, SANGDAM_MEMO, ETC_MEMO
           FROM TA_CASE_MEMO
           WHERE CASE_SEQ = #{caseSeq} 
		]]>
	</select>
	
	<!-- 메모 삭제 -->
	<delete id="deleteMemo" parameterType="zvl">
		<![CDATA[
		/* deleteMemo */
		DELETE
		  FROM TA_CASE_MEMO
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</delete>
	
	<!-- 가해자정보 등록 -->
    <insert id="saveCaseAttkr" parameterType="zvl">
		<![CDATA[
		/* saveCaseAttkr */
		INSERT
		  INTO TA_CASE_ATTKR
		       (
		           ATTKR_SEQ
				, CASE_SEQ
				, ATTKR_AGE
				, ATTKR_FRGER
				, ATTKR_DISABLE
				, ATTKR_REL
				, ATTKR_SEX
				, ATTKR_STATE
				, ATTKR_MEMO
				, ATTKR_DISABLE_MEMO
				, ATTKR_FRGER_MEMO
				, ATTKR_REL_GRP
				, ATTKR_STATE_YN
				, OLD_GROUP1
				, OLD_GROUP2
				, ATTKR_REL_MEMO
		       )
		       VALUES
		       (
		          #{attkrSeq}
				, #{caseSeq}
				, #{attkrAge}
				, #{attkrFrger}
				, #{attkrDisable}
				, #{attkrRel}
				, #{attkrSex}
				, #{attkrState2}
				, #{attkrMemo}
				, #{attkrDisableMemo}
				, #{attkrFrgerMemo}
				, #{attkrRelGrp}
				, #{attkrStateYn}
				, #{oldGroup1}
				, #{oldGroup2}
				, #{attkrRelMemo}
		       )
		]]>
	</insert>
	
	<!-- 가해자정보 수정 -->
    <update id="updateCaseAttkr" parameterType="zvl">
		<![CDATA[
		/* updateCaseAttkr */
		UPDATE TA_CASE_ATTKR 
		   SET ATTKR_AGE = #{attkrAge}
			, ATTKR_FRGER = #{attkrFrger}
			, ATTKR_DISABLE = #{attkrDisable}
			, ATTKR_REL = #{attkrRel}
			, ATTKR_SEX = #{attkrSex}
			, ATTKR_STATE = #{attkrState2}
			, ATTKR_MEMO = #{attkrMemo}
			, ATTKR_DISABLE_MEMO = #{attkrDisableMemo}
			, ATTKR_FRGER_MEMO = #{attkrFrgerMemo}
			, ATTKR_REL_GRP = #{attkrRelGrp}
			, ATTKR_STATE_YN = #{attkrStateYn}
			, OLD_GROUP1 = #{oldGroup1}
			, OLD_GROUP2 = #{oldGroup2}
			, ATTKR_REL_MEMO = #{attkrRelMemo}
		WHERE ATTKR_SEQ = #{attkrSeq}
		 AND CASE_SEQ = #{caseSeq}
		]]>
	</update>
	
	<!-- 가해자정보 삭제 -->
	<delete id="deleteCaseAttkr" parameterType="zvl">
		<![CDATA[
		/* deleteCaseAttkr */
		DELETE
		  FROM TA_CASE_ATTKR
		 WHERE ATTKR_SEQ = #{attkrSeq}
		 AND CASE_SEQ = #{caseSeq}
		]]>
	</delete>
	
	<!-- 지원 서비스 건수 -->
	<select id="countPass" parameterType="zvl" resultType="long">
		<![CDATA[
		/* countPass */
		SELECT COUNT(*) AS totcnt
		   FROM TA_CASE A
     LEFT OUTER JOIN TA_PASS B
        			ON A.CASE_SEQ = B.CASE_SEQ
		 WHERE A.CASE_DELETED = 'N' 
		   AND B.PASS_SEQ IS NOT NULL
		]]>
		<include refid="case-where" />
        <include refid="pass-where" />
	</select>
	
	<!-- 지원 서비스 리스트 -->
	<select id="findPassList" parameterType="zvl" resultType="zvl"> 
		<![CDATA[
		/* findPassList */
		 SELECT B.PASS_SEQ
			, B.CASE_SEQ
			, B.CENTER_CODE
			, FU_GETUSER_NM(B.PASS_MANAGER) AS PASS_MANAGER
			, B.PASS_MANAGER AS PASS_MANAGER_CD
			, B.PASS_DATE
			, B.PASS_TYPE
			, FN_GET_CODE_NAME('PSA1', B.PASS_TYPE) AS PASS_TYPE_NM
			, B.SUB1_DATA
			, FN_GET_CODE_NAME('PSA2', B.SUB1_DATA) AS SUB1_DATA_NM
			, B.SUB2_DATA
			, FN_GET_CODE_NAME('PSA3', B.SUB2_DATA) AS SUB2_DATA_NM
			, ECL_DECRYPT(B.USER_NAME) AS USER_NAME
			, B.USER_REL
			, FN_GET_CODE_NAME('CS25', B.USER_REL) AS USER_REL_NM
			, B.PASS_NAME
			, B.PASS_TERM
			, B.PASS_WAY
			, FN_GET_CODE_NAME('CS21', B.PASS_WAY) AS PASS_WAY_NM
			, B.PASS_TIME
			, B.PASS_MEMO
			, B.PASS_REL_TYPE
			, FN_GET_CODE_NAME('PSRY', B.PASS_REL_TYPE) AS PASS_REL_TYPE_NM
			, B.USER_REL_GRP
			, FN_GET_CODE_NAME('CS25G', B.USER_REL_GRP) AS USER_REL_GRP_NM
			, B.PASS_TEXT
			, B.SUB1_NAME
			, B.SUB2_NAME
			, B.PASS_TIME_E
			, B.RCP_ITV_NUM
			, B.PASS_TEXT_YN
			, B.PASS_CDATE
			, B.PASS_UDATE
			, FN_GET_CODE_NAME('CSAB', A.CASE_TYPE) AS CASE_TYPE_NM
			, A.CASE_TYPE
			, A.VICTIM_NAME
          FROM TA_CASE A, TA_PASS B
         WHERE A.CASE_SEQ = B.CASE_SEQ 
           AND A.CASE_DELETED = 'N' 
           AND B.PASS_SEQ IS NOT NULL
		]]>
		<if test='caseSeq != null and caseSeq != ""'>
			<![CDATA[   AND A.CASE_SEQ = #{caseSeq}     ]]>
		</if>
		<include refid="case-where" />
		<include refid="pass-where" />
		<include refid="pass-order" />
		<![CDATA[
		limit #{firstIndex}, #{recordCountPerPage}
		]]>
	</select>
	
	<!-- 초기 지원 서비스 건수 -->
	<select id="countCasePass" parameterType="zvl" resultType="long">
		<![CDATA[
		/* countCasePass */
		SELECT COUNT(*) AS totcnt
		  FROM TA_PASS B
		 WHERE B.CASE_SEQ = #{caseSeq}
		]]>
		<include refid="pass-where" />
	</select>
	
	<select id="findCasePassList" parameterType="zvl" resultType="zvl"> 
		<![CDATA[
		/* findCasePassList */
		 SELECT B.PASS_SEQ
			, B.CASE_SEQ
			, B.CENTER_CODE
			, FU_GETUSER_NM(B.PASS_MANAGER) AS PASS_MANAGER
			, B.PASS_MANAGER AS PASS_MANAGER_CD
			, B.PASS_DATE
			, B.PASS_TYPE
			, FN_GET_CODE_NAME('PSA1', B.PASS_TYPE) AS PASS_TYPE_NM
			, B.SUB1_DATA
			, FN_GET_CODE_NAME('PSA2', B.SUB1_DATA) AS SUB1_DATA_NM
			, B.SUB2_DATA
			, FN_GET_CODE_NAME('PSA3', B.SUB2_DATA) AS SUB2_DATA_NM
			, ECL_DECRYPT(B.USER_NAME) AS USER_NAME
			, B.USER_REL
			, FN_GET_CODE_NAME('CS25', B.USER_REL) AS USER_REL_NM
			, B.PASS_NAME
			, B.PASS_TERM
			, B.PASS_WAY
			, FN_GET_CODE_NAME('CS21', B.PASS_WAY) AS PASS_WAY_NM
			, B.PASS_TIME
			, B.PASS_MEMO
			, B.PASS_REL_TYPE
			, FN_GET_CODE_NAME('PSRY', B.PASS_REL_TYPE) AS PASS_REL_TYPE_NM
			, B.USER_REL_GRP
			, FN_GET_CODE_NAME('CS25G', B.USER_REL_GRP) AS USER_REL_GRP_NM
			, B.PASS_TEXT
			, B.SUB1_NAME
			, B.SUB2_NAME
			, B.PASS_TIME_E
			, B.RCP_ITV_NUM
			, B.PASS_TEXT_YN
			, B.PASS_CDATE
			, B.PASS_UDATE
			, ECL_DECRYPT(A.VICTIM_BIRTH) AS VICTIM_BIRTH
          FROM TA_PASS B INNER JOIN TA_CASE A ON A.CASE_SEQ = B.CASE_SEQ
         WHERE B.PASS_SEQ IS NOT NULL
		]]>
		<if test='caseSeq != null and caseSeq != ""'>
			<![CDATA[   AND B.CASE_SEQ = #{caseSeq}     ]]>
		</if>
		<include refid="pass-where" />
		<include refid="pass-order" />
		<![CDATA[
        limit #{firstIndex}, #{recordCountPerPage}
        ]]>
	</select>
	
	<select id="findPassTypeList" parameterType="zvl" resultType="zvl"> 
		<![CDATA[
		/* findPassTypeList */
		 SELECT B.PASS_SEQ
			, B.CASE_SEQ
			, B.CENTER_CODE
			, B.PASS_TYPE
			, B.SUB1_DATA
			, B.SUB2_DATA
          FROM TA_PASS B
         WHERE B.CASE_SEQ = #{caseSeq}
           AND B.PASS_SEQ <> #{passSeq}
           AND B.PASS_SEQ IS NOT NULL
		]]>
	</select>
	
	<!-- 초기 지원 서비스 건수(첫조회)  -->
	<select id="countCasePass2" parameterType="zvl" resultType="long">
		<![CDATA[
		/* countCasePass2 */
		SELECT COUNT(*) AS totcnt
		  FROM TA_PASS A
		 WHERE A.CASE_SEQ = (SELECT CASE_SEQ
								FROM TA_CASE A
								WHERE A.CASE_DELETED = 'N' 
		]]>
		<include refid="case-where" />
		<![CDATA[
								ORDER BY A.CASE_SEQ DESC
								LIMIT 1)
		]]>
	</select>
	
	<!-- 초기 지원 서비스 상세 리스트(첫조회) -->
	<select id="findCasePassList2" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCasePassList2 */
		SELECT B.PASS_SEQ
			, B.CASE_SEQ
			, B.CENTER_CODE
			, FU_GETUSER_NM(B.PASS_MANAGER) AS PASS_MANAGER
			, B.PASS_MANAGER AS PASS_MANAGER_CD
			, B.PASS_DATE
			, B.PASS_TYPE
			, FN_GET_CODE_NAME('PSA1', B.PASS_TYPE) AS PASS_TYPE_NM
			, B.SUB1_DATA
			, FN_GET_CODE_NAME('PSA2', B.SUB1_DATA) AS SUB1_DATA_NM
			, B.SUB2_DATA
			, FN_GET_CODE_NAME('PSA3', B.SUB2_DATA) AS SUB2_DATA_NM
			, ECL_DECRYPT(B.USER_NAME) AS USER_NAME
			, B.USER_REL
			, FN_GET_CODE_NAME('CS25', B.USER_REL) AS USER_REL_NM
			, B.PASS_NAME
			, B.PASS_TERM
			, B.PASS_WAY
			, FN_GET_CODE_NAME('CS21', B.PASS_WAY) AS PASS_WAY_NM
			, B.PASS_TIME
			, B.PASS_MEMO
			, B.PASS_REL_TYPE
			, FN_GET_CODE_NAME('PSRY', B.PASS_REL_TYPE) AS PASS_REL_TYPE_NM
			, B.USER_REL_GRP
			, FN_GET_CODE_NAME('CS25G', B.USER_REL_GRP) AS USER_REL_GRP_NM
			, B.PASS_TEXT
			, B.SUB1_NAME
			, B.SUB2_NAME
			, B.PASS_TIME_E
			, B.RCP_ITV_NUM
			, B.PASS_TEXT_YN
			, B.PASS_CDATE
			, B.PASS_UDATE
			, FN_GET_CODE_NAME('CSAB', A.CASE_TYPE) AS CASE_TYPE_NM
			, A.CASE_TYPE
			, A.VICTIM_NAME
			, B.PASS_UDATE
         FROM TA_CASE A, TA_PASS B
         WHERE A.CASE_SEQ = B.CASE_SEQ 
           AND A.CASE_DELETED = 'N' 
           AND B.PASS_SEQ IS NOT NULL
		]]>
		<if test='caseSeq != null and caseSeq != ""'>
			<![CDATA[   AND A.CASE_SEQ = #{caseSeq}     ]]>
		</if>
		<include refid="pass-where2" />
		<include refid="pass-order" />
        <if test='printYN != "Y"'>
		 <!-- limit #{startPage},#{lastPage}  -->
		</if>
	</select>
	
	
	<!-- 초기 지원 서비스 상세 리스트(첫조회) -->
	<select id="findCasePassList3" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCasePassList3 */
		SELECT B.PASS_SEQ
			, B.CASE_SEQ
			, B.CENTER_CODE
			, FU_GETUSER_NM(B.PASS_MANAGER) AS PASS_MANAGER
			, B.PASS_MANAGER AS PASS_MANAGER_CD
			, B.PASS_DATE
			, B.PASS_TYPE
			, FN_GET_CODE_NAME('PSA1', B.PASS_TYPE) AS PASS_TYPE_NM
			, B.SUB1_DATA
			, FN_GET_CODE_NAME('PSA2', B.SUB1_DATA) AS SUB1_DATA_NM
			, B.SUB2_DATA
			, FN_GET_CODE_NAME('PSA3', B.SUB2_DATA) AS SUB2_DATA_NM
			, ECL_DECRYPT(B.USER_NAME) AS USER_NAME
			, B.USER_REL
			, FN_GET_CODE_NAME('CS25', B.USER_REL) AS USER_REL_NM
			, B.PASS_NAME
			, B.PASS_TERM
			, B.PASS_WAY
			, FN_GET_CODE_NAME('CS21', B.PASS_WAY) AS PASS_WAY_NM
			, B.PASS_TIME
			, B.PASS_MEMO
			, B.PASS_REL_TYPE
			, FN_GET_CODE_NAME('PSRY', B.PASS_REL_TYPE) AS PASS_REL_TYPE_NM
			, B.USER_REL_GRP
			, FN_GET_CODE_NAME('CS25G', B.USER_REL_GRP) AS USER_REL_GRP_NM
			, B.PASS_TEXT
			, B.SUB1_NAME
			, B.SUB2_NAME
			, B.PASS_TIME_E
			, B.RCP_ITV_NUM
			, B.PASS_TEXT_YN
			, B.PASS_CDATE
			, B.PASS_UDATE
			, FN_GET_CODE_NAME('CSAB', A.CASE_TYPE) AS CASE_TYPE_NM
			, A.CASE_TYPE
			, A.VICTIM_NAME
			, B.PASS_UDATE
         FROM TA_CASE A, TA_PASS B
         WHERE A.CASE_SEQ = B.CASE_SEQ 
           AND A.CASE_DELETED = 'N' 
           AND B.PASS_SEQ IS NOT NULL
		]]>
		<if test='caseSeq != null and caseSeq != ""'>
			<![CDATA[   AND A.CASE_SEQ = #{caseSeq}     ]]>
		</if>
		<include refid="pass-where2" />
		<include refid="pass-order" />
        <if test='printYN != "Y"'>
		 limit #{startPage},#{lastPage}  
		</if>
	</select>
	
	<!-- 초기 지원 서비스 상세 리스트(첫조회) -->
	<select id="countAllCasePassList2" parameterType="zvl" resultType="long">
		<![CDATA[
		/* countAllCasePassList2 */
		SELECT count(a.case_seq)
         FROM TA_CASE A, TA_PASS B
         WHERE A.CASE_SEQ = B.CASE_SEQ 
           AND A.CASE_DELETED = 'N' 
           AND B.PASS_SEQ IS NOT NULL
           
		]]>
	  <include refid="pass-where2" />
	</select>
	
	
	<select id="countCasePassList2" parameterType="zvl" resultType="long">
        <![CDATA[
        /* countCasePassList2 */
        SELECT COUNT(*) AS totcnt
           FROM TA_PASS A
         WHERE A.CASE_SEQ = #{caseSeq}
        ]]>
	</select>
	
	<!-- 초기 지원 서비스 상세 리스트(첫조회) -->
	<select id="findCaseLimitView" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCaseLimitView */
		SELECT A.VICTIM_NAME
            , A.CASE_NUMBER
			FROM TA_CASE A
			WHERE A.CASE_SEQ = (SELECT CASE_SEQ
								FROM TA_CASE A
								WHERE A.CASE_DELETED = 'N' 
		]]>
		<include refid="case-where" />
		<![CDATA[
								ORDER BY A.CASE_SEQ DESC
								LIMIT 1)
		]]>
	</select>
	
	<!-- 초기 지원 서비스 상세 -->
	<select id="findPassView" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findPassView */
		SELECT A.PASS_SEQ
			, A.CASE_SEQ
			, A.CENTER_CODE
			, FU_GETUSER_NM(A.PASS_MANAGER) AS PASS_MANAGER
			, A.PASS_MANAGER AS PASS_MANAGER_CD
			, A.PASS_DATE
			, A.PASS_TYPE
			, IFNULL(FN_GET_CODE_NAME('PSA1', A.PASS_TYPE), '') AS PASS_TYPE_NM
			, A.SUB1_DATA
			, IFNULL(FN_GET_CODE_NAME('PSA2', A.SUB1_DATA), '') AS SUB1_DATA_NM
			, A.SUB2_DATA
			, IFNULL(FN_GET_CODE_NAME('PSA3', A.SUB2_DATA), '') AS SUB2_DATA_NM
			, ECL_DECRYPT(A.USER_NAME) AS USER_NAME
			, A.USER_REL
			, IFNULL(FN_GET_CODE_NAME('CS25', A.USER_REL), '') AS USER_REL_NM
			, A.PASS_NAME
			, A.PASS_TERM
			, A.PASS_WAY
			, IFNULL(FN_GET_CODE_NAME('CS21', A.PASS_WAY), '') AS PASS_WAY_NM
			, A.PASS_TIME
			, A.PASS_MEMO
			, A.PASS_REL_TYPE
			, IFNULL(FN_GET_CODE_NAME('PSRY', A.PASS_REL_TYPE), '') AS PASS_REL_TYPE_NM
			, A.USER_REL_GRP
			, IFNULL(FN_GET_CODE_NAME('CS25G', A.USER_REL_GRP), '') AS USER_REL_GRP_NM
			, A.PASS_TEXT
			, IFNULL(A.SUB1_NAME, '') AS SUB1_NAME
			, IFNULL(A.SUB2_NAME, '') AS SUB2_NAME
			, A.PASS_TIME_E
			, IFNULL(A.RCP_ITV_NUM, '') AS RCP_ITV_NUM
			, A.PASS_TEXT_YN
			, A.PASS_CDATE
			, A.PASS_UDATE
		  FROM TA_PASS A
		 WHERE A.CASE_SEQ = #{caseSeq}
		 AND A.PASS_SEQ = #{passSeq}
		]]>
	</select>
	
	<!-- 지원서비스 등록 -->
    <insert id="savePass" parameterType="zvl">
    	<selectKey resultType="Integer" order="BEFORE" keyProperty="passSeq">
			SELECT IFNULL(MAX(PASS_SEQ),0)+1 AS PASS_SEQ  FROM TA_PASS
		</selectKey>
		<![CDATA[
		/* savePass */
		INSERT INTO TA_PASS ( PASS_SEQ, CASE_SEQ, CENTER_CODE, PASS_MANAGER, PASS_DATE, PASS_TIME, PASS_TIME_E, PASS_WAY
                          , PASS_TYPE, SUB1_DATA, SUB2_DATA
                          , USER_NAME, USER_REL_GRP, USER_REL, PASS_REL_TYPE, PASS_MEMO, PASS_TEXT
                          , PASS_NAME, SUB1_NAME, SUB2_NAME
         ) VALUES (
                    #{passSeq},#{caseSeq},#{centerCode},#{userId},#{passDate}, #{passTime},#{passTimeE}, #{passWay} 
                   ,#{passType}, #{sub1Data}, #{sub2Data}
                   ,ECL_ENCRYPT(#{userName}), #{userRelGrp}, #{userRel}, #{passRelType}, #{passMemo}, #{passText}
                   ,FN_GET_CODE_NAME('PSA1', #{passType}), FN_GET_CODE_NAME('PSA2', #{sub1Data}), FN_GET_CODE_NAME('PSA3', #{sub2Data})
                    ) 
		]]>
	</insert>
	
	<!-- 사례접수정보 수정시 초기지원서비스 수정 -->
	<update id="updatePassEryy" parameterType="zvl">
		<![CDATA[
		/* updatePassEryy */
		
		UPDATE	TA_PASS
		SET		PASS_DATE = #{caseDate}
				, PASS_TIME = #{caseTime}
				, PASS_TIME_E = #{caseTimeE}
				, PASS_WAY = #{caseJupsoo}
				, USER_NAME = ECL_ENCRYPT(#{client})
				, USER_REL_GRP = #{clientRelGrp}
				, USER_REL = #{clientRel}
				, PASS_REL_TYPE = '1'
		WHERE	CASE_SEQ = #{caseSeq} AND PASS_TYPE='4' AND SUB1_DATA='4A'
		]]>
	</update>
	
	<!-- 지원서비스 수정 -->
    <update id="updatePass" parameterType="zvl">
		<![CDATA[
		/* updatePass */
			UPDATE TA_PASS 
               SET PASS_DATE = #{passDate} 
                 , PASS_TIME = #{passTime} 
                 , PASS_TIME_E = #{passTimeE} 
                 , PASS_WAY  = #{passWay} 
                 , USER_NAME = ECL_ENCRYPT(#{userName})
                 , USER_REL_GRP = #{userRelGrp} 
                 , USER_REL = #{userRel} 
                 , PASS_REL_TYPE = #{passRelType}
                 , PASS_MEMO = #{passMemo} 
                 , PASS_TEXT = #{passText} 
                 , PASS_TYPE = #{passType} 
                 , SUB1_DATA = #{sub1Data} 
                 , SUB2_DATA = #{sub2Data} 
                 , PASS_NAME = FN_GET_CODE_NAME('PSA1', #{passType})
                 , SUB1_NAME = FN_GET_CODE_NAME('PSA2', #{sub1Data})
                 , SUB2_NAME = FN_GET_CODE_NAME('PSA3', #{sub2Data})
                 , PASS_TEXT_YN  ='Y'
                 , PASS_UDATE = NOW()
             WHERE PASS_SEQ = #{passSeq} 
		]]>
	</update>
	
	<!-- 지원서비스 삭제 -->
	<delete id="deletePass" parameterType="zvl">
		<![CDATA[
		/* deletePass */
		DELETE FROM TA_PASS
		 WHERE CASE_SEQ = #{caseSeq}
		 AND PASS_SEQ = #{passSeq}
		]]>
	</delete>
	
	<!-- 지원서비스 삭제 -->
	<delete id="deleteCasePass" parameterType="zvl">
		<![CDATA[
		/* deleteCasePass */
		DELETE FROM TA_PASS
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</delete>
	
	<!-- 공통코드 조회 -->
	<select id="findCdList" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCdList */
		SELECT CODEG_CODE, CODE_CODE, CODE_NAME, CODE_SUBCODE
           FROM TB_CODE
          WHERE CODEG_CODE = #{codegCode}
           AND CODE_USE_YN='Y'
		]]>
        <if test='cdWhere != null and cdWhere != ""'>
            <![CDATA[    AND CODE_CODE IN  ]]>
				<foreach collection="cdWhere" item="code" index="index" separator="," open="(" close=")">
			        #{code}
				</foreach>
		</if>
		<![CDATA[
        ORDER BY CODE_SORT
		]]>
	</select>
	
	<!-- 공통코드 상세조회 -->
	<select id="findCdDetailList" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCdDetailList */
		SELECT CODEG_CODE, CODE_CODE, CODE_NAME, CODE_SUBCODE
           FROM TB_CODE
          WHERE CODEG_CODE = #{codegCode}
           AND CODE_USE_YN='Y'
           AND CODE_GROUP = #{codeGroup}
		]]>
        <if test='cdWhere != null and cdWhere != ""'>
            <![CDATA[    AND CODE_CODE IN (#{cdWhere}) ]]>
		</if>
		<![CDATA[
        ORDER BY CODE_SORT
		]]>
	</select>
	
	<!-- 전산관리번호 생성 -->
	<select id="findCaseNumber" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCaseNumber */
		SELECT A.AREA_COD AS AREA_CD
			, A.CNTR_GUBUN AS CNTR_GBN
			, FN_GET_CODE_NAME('CM04', A.CNTR_GUBUN) CNTR_GBN_NM
		    , A.CNTR_COD
		    , FN_GET_CODE_NAME('CM05', A.CNTR_COD) CNTR_COD_NM
		    , MID(DATE_FORMAT(now(), '%Y%m%d'), 3, 6) AS MID_DATE
		    , CONCAT(
		    		(SELECT NVL(CN_NUMBER, 0) + 1
								   FROM TA_CASE_NUMBER
								  WHERE CN_DATE = DATE_FORMAT(NOW(),'%Y') 
								    AND CN_CENTER=(SELECT CENTER_CODE
													FROM TA_USER 
													WHERE USER_ID=#{loginUserId})
					)
			) AS CASE_NUMBER
		FROM TB_CNTR A
		WHERE CNTR_COD=(SELECT CENTER_CODE
						  FROM TA_USER 
						 WHERE USER_ID = #{loginUserId})
		]]>
	</select>
	
	<!--  전산관리 번호 넘버 조회 -->
	<select id="countCaseNumber" parameterType="zvl" resultType="long">
		<![CDATA[
		/* countCaseNumber */
		SELECT CN_DATE, CN_CENTER, CN_NUMBER
    	  FROM TA_CASE_NUMBER
     	  WHERE CN_DATE=DATE_FORMAT(NOW(),'%Y')
     	   AND CN_CENTER = #{centerCode}
		]]>
	</select>
	
	<!-- 전산관리 번호 넘버 등록 -->
    <insert id="saveCaseNumber" parameterType="zvl">
		<![CDATA[
		/* saveCaseNumber */
		INSERT INTO TA_CASE_NUMBER ( CN_DATE, CN_CENTER, CN_NUMBER )                  
          VALUES (DATE_FORMAT(NOW(),'%Y'), #{centerCode}, 1)
		]]>
	</insert>
	
	<!-- 전산관리 번호 넘버 업데이트 -->
    <update id="updateCaseNumber" parameterType="zvl">
		<![CDATA[
		/* updateCaseNumber */
		UPDATE TA_CASE_NUMBER
		SET CN_NUMBER = CN_NUMBER + 1
		WHERE CN_DATE=DATE_FORMAT(NOW(),'%Y')
     	  AND CN_CENTER = #{centerCode}
		]]>
	</update>
	
	<!-- 연락처 건수 -->
	<select id="countCaseContact" parameterType="zvl" resultType="long">
		<![CDATA[
		/* countCaseContact */
		SELECT COUNT(*) AS totcnt
		  FROM TA_CASE_CONTACT A
		 WHERE A.CASE_SEQ = #{caseSeq}
		]]>
	</select>
	
	<!-- 연락처 상세 리스트 -->
	<select id="findCaseContactList" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCaseContactList */
		SELECT A.CC_SEQ
			, A.CASE_SEQ
			, A.CC_REL
			, A.CC_NAME
			, A.CC_PHONE
			, A.CC_EMAIL
			, A.CC_MEMO
			, CONCAT(A.CC_SEQ) CC_SEQ_C
		  FROM TA_CASE_CONTACT A
		 WHERE A.CASE_SEQ = #{caseSeq}
		]]>
	</select>
	
	<!-- 연락처 등록 -->
    <insert id="saveCaseContact" parameterType="zvl">
    	<selectKey resultType="Integer" order="BEFORE" keyProperty="ccSeq">
			SELECT IFNULL(MAX(CC_SEQ),0)+1 AS CC_SEQ  FROM TA_CASE_CONTACT
		</selectKey>
		<![CDATA[
		/* saveCaseContact */
		INSERT INTO TA_CASE_CONTACT ( 
			CC_SEQ, CASE_SEQ, CC_REL, CC_NAME, CC_PHONE, CC_EMAIL, CC_MEMO
 		) VALUES (
 			#{ccSeq}, #{caseSeq}, #{ccRel}, #{ccName}, #{ccPhone}, #{ccEmail}, #{ccMemo}
 		)
		]]>
	</insert>
	
	<!-- 연락처 수정 -->
    <update id="updateCaseContact" parameterType="zvl">
		<![CDATA[
		/* updateCaseContact */
		UPDATE TA_CASE_CONTACT
		  SET CC_REL = #{ccRel}
			, CC_NAME = #{ccName}
			, CC_PHONE = #{ccPhone}
			, CC_EMAIL = #{ccEmail}
			, CC_MEMO = #{ccMemo}
		WHERE CC_SEQ = #{ccSeq}
		]]>
	</update>
	
	<!-- 연락처 삭제 -->
	<delete id="deleteContact" parameterType="zvl">
		<![CDATA[
		/* deleteContact */
		DELETE
		  FROM TA_CASE_CONTACT
		 WHERE CC_SEQ = #{ccSeq}
		]]>
	</delete>
	
	<!-- SMS 목록 -->
	<select id="findCaseSmsList" parameterType="zvl" resultType="zvl">
		<![CDATA[
			/* findCaseSmsList */
			SELECT	SEQ, GROUP_ID, USER_ID
					, FN_GET_CODE_NAME('CM05', SUBSTR(group_id, 5, 3)) AS GROUP_NAME
					, USER_NAME, R_NAME, R_PHONE, CASE SMS_TYPE WHEN '' THEN 'S' ELSE SMS_TYPE END as SMS_TYPE, SUBJECT
					, MSG_DATE, SEND_RESULT, SEND_PHONE, MSG, SEND_DATE
			FROM TB_SMS A
			WHERE A.GROUP_ID LIKE 'sun_%'
			  AND  A.CASE_SEQ = #{caseSeq} 
		    ORDER BY SEND_DATE DESC
			limit #{firstIndex}, #{recordCountPerPage}
		]]>
	</select>
	
	<!-- SMS 전체count수 -->
	<select id="countCaseSms" parameterType="zvl" resultType="Long">
		<![CDATA[
			/* countCaseSms  */
			SELECT COUNT(SEQ) AS totCnt
			  FROM TB_SMS A
			 WHERE A.GROUP_ID LIKE 'sun_%'
			  AND  A.CASE_SEQ = #{caseSeq} 
		]]>
	</select>
	
	<!-- 사례 연락처 삭제 -->
	<delete id="deleteCaseContact" parameterType="zvl">
		<![CDATA[
		/* deleteCaseContact */
		DELETE
		  FROM TA_CASE_CONTACT
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</delete>
	
	<!-- 사례 이력 등록 -->
    <insert id="saveCaseHistory" parameterType="zvl">
    	<selectKey resultType="Integer" order="BEFORE" keyProperty="chSeq">
			SELECT IFNULL(MAX(CH_SEQ),0)+1 AS CH_SEQ  FROM TA_CASE_HISTORY
		</selectKey>
		<![CDATA[
		/* saveCaseHistory */
		INSERT INTO TA_CASE_HISTORY ( 
			CH_SEQ, CASE_SEQ, CH_GROUP, CH_USER_ID, CH_MEMO, CH_DATE, CH_USER_NM, CH_ACTION, CH_GROUP_SEQ
 		) VALUES (
			#{chSeq}, #{caseSeq}, #{chGroup}, #{chUserId}, #{chMemo}, NOW(), #{chUserNm}, #{chAction}, #{chGroupSeq}
 		)
		]]>
	</insert>
	
	<!-- 관리 건수 -->
	<select id="countCaseManage" parameterType="zvl" resultType="long">
		<![CDATA[
		/* countCaseManage */
		SELECT COUNT(*) AS totcnt
		  FROM TA_CASE_HISTORY A
		  JOIN TA_USER B
          ON  A.CH_USER_ID = B.USER_ID
          WHERE A.CASE_SEQ = #{caseSeq}
                AND B.CENTER_CODE NOT IN ('701') 
                AND B.USER_LEVEL NOT IN ('CA', 'ROLE_SUPER')
		]]>
	</select>
	
	<!-- 관리 상세 리스트 -->
	<select id="findCaseManageList" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findCaseManageList */
		SELECT A.CH_SEQ
			, A.CASE_SEQ
			, A.CH_GROUP
            , FN_GET_CODE_NAME('HSCD', A.CH_GROUP) as CH_GROUP_NM
			, A.CH_USER_ID
			, A.CH_MEMO
			, A.CH_DATE
			, A.CH_USER_NM
			, A.CH_ACTION
            , FN_GET_CODE_NAME('HSCE', A.CH_ACTION) as CH_ACTION_NM
			, A.CH_GROUP_SEQ
			, CONCAT(A.CH_SEQ) CH_SEQ_C
          FROM TA_CASE_HISTORY A
          JOIN TA_USER B
          ON  A.CH_USER_ID = B.USER_ID
          WHERE A.CASE_SEQ = #{caseSeq}
                AND B.CENTER_CODE NOT IN ('701') 
                AND B.USER_LEVEL NOT IN ('CA', 'ROLE_SUPER')
         ORDER BY A.CH_SEQ DESC
		 limit #{firstIndex}, #{recordCountPerPage}
		]]>
	</select>
	
	<!-- 북마크 건수 -->
	<select id="countCaseBook" parameterType="zvl" resultType="long">
		<![CDATA[
		/* countCaseBook */
		 SELECT COUNT(*) USER_BOOKMARK_CNT 
		 FROM TA_CASE_BOOKMARK A
	LEFT OUTER JOIN TA_CASE B
		 		ON A.CASE_SEQ = B.CASE_SEQ
		  WHERE A.MEMBER_ID = #{userId}
		  AND A.CASE_SEQ = #{caseSeq}
		]]>
	</select>
	
	<!-- 사례보관함 이동 -->
	<update id="updateCaseFinish" parameterType="zvl">
		<![CDATA[
		/* updateCaseFinish */
		UPDATE TA_CASE SET 
			  CASE_FINISH = #{caseFinish}
		 WHERE CASE_SEQ = #{caseSeq} 
		]]>
	</update>

	<!-- 종결사례함 이동 -->
	<update id="updateCaseEnd" parameterType="zvl">
		<![CDATA[
		/* updateCaseEnd */
		UPDATE TA_CASE SET 
			  CASE_END = #{caseEnd}
		 WHERE CASE_SEQ = #{caseSeq} 
		]]>
	</update>
	
	<!-- 사례 즐겨찾기 삭제 -->
	<delete id="deleteBookmark" parameterType="zvl">
		<![CDATA[
		/* deleteBookmark */
		DELETE
		  FROM TA_CASE_BOOKMARK
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</delete>
	
	<!-- 사례 즐겨찾기 삭제 -->
	<delete id="deleteCaseBookmark" parameterType="zvl">
		<![CDATA[
		/* deleteCaseBookmark */
		DELETE
		  FROM TA_CASE_BOOKMARK
		 WHERE CASE_SEQ = #{caseSeq}
		  AND MEMBER_ID = #{memberId}
		]]>
	</delete>
	
	<!-- 사례 즐겨찾기 등록 -->
    <insert id="insertCaseBookmark" parameterType="zvl">
		<![CDATA[
		/* insertCaseBookmark */
		INSERT INTO TA_CASE_BOOKMARK ( CASE_SEQ, MEMBER_ID) 
		VALUES ( #{caseSeq}, #{memberId} ) 
		]]>
	</insert>

    <!-- 센터 정보 조회 -->
    <select id="findCenterInfo" parameterType="zvl" resultType="zvl">
        <![CDATA[
        /*findCenterInfo*/
        SELECT A.*
        FROM TB_CNTR A
        WHERE A.CNTR_COD = (SELECT B.CENTER_CODE 
                          FROM TA_CASE B
                          WHERE B.CASE_SEQ = #{caseSeq})
        ]]>
    </select>   

    <!-- 출력 이력 조회 -->
    <select id="findPrintHistory" parameterType="zvl" resultType="zvl">
        <![CDATA[
        /*findPrintHistory*/
        SELECT * 
        FROM TA_PRINT_HISTORY 
        WHERE CASE_SEQ = #{caseSeq}
        LIMIT #{firstIndex}, #{recordCountPerPage}    
        ]]>
    </select>
    
    <!-- 출력 이력 건수 -->
    <select id="countPrintHistory" parameterType="zvl" resultType="long">
        <![CDATA[
        /* countPrintHistory */
        SELECT COUNT(*) AS totcnt
          FROM TA_PRINT_HISTORY A
         WHERE A.CASE_SEQ = #{caseSeq}
        ]]>
    </select>


    <!-- 첨부파일 조회 -->
    <select id="findOneFile" parameterType="zvl" resultType="zvl">
        <![CDATA[
        /*findOneFile*/
        SELECT UFL_SEQ,
               TRUNCATE(UFL_FILESIZE/1024, 0) as UFL_FILESIZE,          
               UFL_FILENAME_ORIGINAL,            
               UFL_FILENAME_EXTENSION,               
               UFL_CUSER,             
               FU_GETUSER_NM(UFL_CUSER) AS UFL_CUSER_NM,     
               DATE_FORMAT(UFL_DATE, '%Y-%m-%d %H:%m:%i') AS UFL_DATE   
        FROM TB_UPLOAD_FILE 
        WHERE UFL_REL_CODE='case' 
              AND UFL_REL_NUMBER=#{caseSeq}
        ]]>
    </select>
    
    <!-- 연락처 조회 -->
    <select id="fineOneContact" parameterType="zvl" resultType="zvl">
        <![CDATA[
        /*findOneContact*/
        SELECT CC_SEQ,
               CASE_SEQ,
               CC_REL,
               CC_NAME,
               CC_PHONE,
               CC_EMAIL,
               CC_MEMO
        FROM TA_CASE_CONTACT 
        WHERE CASE_SEQ=#{caseSeq}
        ]]>
    </select>
    
    <!-- 사례 관리 이력 조회 -->
    <select id="findCaseHistory" parameterType="zvl" resultType="zvl">
        <![CDATA[
        /*findCaseHistory*/
        SELECT  A.CH_SEQ,
                A.CASE_SEQ,
                FN_GET_CODE_NAME('HSCD', A.CH_GROUP) as CH_GROUP,
                A.CH_USER_ID,
                A.CH_MEMO,
                DATE_FORMAT(A.CH_DATE, '%Y-%m-%d %H:%m:%i') AS CH_DATE,
                A.CH_USER_NM,
                FN_GET_CODE_NAME('HSCE', A.CH_ACTION) as CH_ACTION
        FROM TA_CASE_HISTORY A
        JOIN TA_USER B
              ON  A.CH_USER_ID = B.USER_ID
        WHERE A.CASE_SEQ = #{caseSeq}
              AND B.CENTER_CODE NOT IN ('701') 
              AND B.USER_LEVEL NOT IN ('CA', 'ROLE_SUPER')
        ]]>
    </select>
    
    <!-- 사례부가정보 상세 -->
	<select id="findOneCaseServ" parameterType="zvl" resultType="zvl">
		<![CDATA[
		/* findOneCaseServ */
	 SELECT CASE_SEQ
	 		,CS_TYPE 
	        , CS_TYPE_GROUP
	        , FN_GET_CODE_NAME('JA01', CS_TYPE_GROUP) as CS_TYPE_GROUP_NM
	        , CS_TYPE_ACT01
	        , CS_TYPE_ACT02
	        , CS_TYPE_ACT03
	        , CS_TYPE_ACT04
	        , CS_TYPE_ACT05
	        , CS_TYPE_ACT06
	        , CS_TYPE_ACT07
	        , CS_TYPE_ACT08
	        , CS_TYPE_ACT09
	        , CS_TYPE_ACT10
	        , CS_GROUP_A01
	        , CS_GROUP_A02
	        , CS_GROUP_A03
	        , CS_GROUP_A04
	        , CS_GROUP_A05
	        , CS_GROUP_A06
	        , CS_GROUP_A07
	        , CS_GROUP_A08
	        , CS_GROUP_A09
	        , CS_GROUP_A10
	        , CS_GROUP_B10
	        , CS_GROUP_B20
	        , CS_GROUP_B30
	        , CS_GROUP_B40
	        , FN_GET_CODE_NAME('JAA1', CS_GROUP_A10) as CS_GROUP_A10_NM
	        , FN_GET_CODE_NAME('JA16', CS_GROUP_B10) as CS_GROUP_B10_NM
	        , FN_GET_CODE_NAME('JA15', CS_GROUP_B20) as CS_GROUP_B20_NM
	        , FN_GET_CODE_NAME('JA14', CS_GROUP_B30) as CS_GROUP_B30_NM
	        , FN_GET_CODE_NAME('JA13', CS_GROUP_B40) as CS_GROUP_B40_NM
	        , CS_GROUP_B50
	        , CS_GROUP_B51
	        , CS_GROUP_B60
	        , CS_GROUP_B61
	        , CS_GROUP_B62
	        , CS_GROUP_C10
	        , CS_GROUP_C20
	        , FN_GET_CODE_NAME('JA17', CS_GROUP_B61) as CS_GROUP_B61_NM
	        , FN_GET_CODE_NAME('JA18', CS_GROUP_B62) as CS_GROUP_B62_NM
	        , FN_GET_CODE_NAME('JA21', CS_GROUP_C10) as CS_GROUP_C10_NM
	        , FN_GET_CODE_NAME('JA22', CS_GROUP_C20) as CS_GROUP_C20_NM
	        , CS_GROUP_C21
	        , CS_GROUP_C22
	        , CS_GROUP_C23
	        , CS_GROUP_C24
	        , FN_GET_CODE_NAME('JA23', CS_GROUP_C22) as CS_GROUP_C22_NM
	        , FN_GET_CODE_NAME('JA23', CS_GROUP_C23) as CS_GROUP_C23_NM
	        , FN_GET_CODE_NAME('JA23', CS_GROUP_C24) as CS_GROUP_C24_NM
	        , CS_GROUP_C22_MEMO
	        , CS_GROUP_C23_MEMO
	        , CS_GROUP_C24_MEMO
	        , CS_GROUP_D10
	        , FN_GET_CODE_NAME('JA31', CS_GROUP_D10) as CS_GROUP_D10_NM
	        , CS_MEMO
       FROM TA_CASE_SERV
	  WHERE CASE_SEQ = #{caseSeq}
		]]>
	</select>
	
	<!-- 사례부가정보 등록 -->
    <insert id="saveCaseServ" parameterType="zvl">
		<![CDATA[
		/* saveCaseServ */
		INSERT INTO TA_CASE_SERV (
			CASE_SEQ, CS_TYPE, CS_TYPE_GROUP, CS_TYPE_ACT01, CS_TYPE_ACT02, CS_TYPE_ACT03, CS_TYPE_ACT04, CS_TYPE_ACT05, CS_TYPE_ACT06
			, CS_TYPE_ACT07, CS_TYPE_ACT08, CS_TYPE_ACT09, CS_TYPE_ACT10, CS_GROUP_A01, CS_GROUP_A02, CS_GROUP_A03, CS_GROUP_A04
			, CS_GROUP_A05, CS_GROUP_A06, CS_GROUP_A07, CS_GROUP_A08, CS_GROUP_A09, CS_GROUP_A10, CS_GROUP_B10, CS_GROUP_B20
			, CS_GROUP_B30, CS_GROUP_B40, CS_GROUP_B50, CS_GROUP_B60, CS_GROUP_B61, CS_GROUP_B62, CS_GROUP_C10, CS_GROUP_C20
			, CS_GROUP_C21, CS_GROUP_C22, CS_GROUP_D10, CS_GROUP_B51, CS_GROUP_C23, CS_GROUP_C24, CS_GROUP_C22_MEMO
			, CS_GROUP_C23_MEMO, CS_GROUP_C24_MEMO, CS_MEMO, OLD_SUPT_CNTS, OLD_CSLOR_OPIN, OLD_OTHER_CSL_CNTS
		       ) VALUES (
		 	#{caseSeq}, #{csType}, #{csTypeGroup}, #{csTypeAct01}, #{csTypeAct02}, #{csTypeAct03}, #{csTypeAct04}, #{csTypeAct05}, #{csTypeAct06}
			, #{csTypeAct07}, #{csTypeAct08}, #{csTypeAct09}, #{csTypeAct10}, #{csGroupA01}, #{csGroupA02}, #{csGroupA03}, #{csGroupA04}
			, #{csGroupA05}, #{csGroupA06}, #{csGroupA07}, #{csGroupA08}, #{csGroupA09}, #{csGroupA10}, #{csGroupB10}, #{csGroupB20}
			, #{csGroupB30}, #{csGroupB40}, #{csGroupB50}, #{csGroupB60}, #{csGroupB61}, #{csGroupB62}, #{csGroupC10}, #{csGroupC20}
			, #{csGroupC21}, #{csGroupC22}, #{csGroupD10}, #{csGroupB51}, #{csGroupC23}, #{csGroupC24}, #{csGroupC22Memo}
			, #{csGroupC23Memo}, #{csGroupC24Memo}, #{csMemo}, #{oldSuptCnts}, #{oldCslorOpin}, #{oldOtherCslCnts}
		       )
		]]>
	</insert>
	
	<!-- 사례부가정보 수정 -->
	<update id="updateCaseServ" parameterType="zvl">
		<![CDATA[
		/* updateCaseServ */
		UPDATE TA_CASE_SERV SET 
			  CS_TYPE = #{csType}
			, CS_TYPE_GROUP = #{csTypeGroup}
			, CS_TYPE_ACT01 = #{csTypeAct01}
			, CS_TYPE_ACT02 = #{csTypeAct02}
			, CS_TYPE_ACT03 = #{csTypeAct03}
			, CS_TYPE_ACT04 = #{csTypeAct04}
			, CS_TYPE_ACT05 = #{csTypeAct05}
			, CS_TYPE_ACT06 = #{csTypeAct06}
			, CS_TYPE_ACT07 = #{csTypeAct07}
			, CS_TYPE_ACT08 = #{csTypeAct08}
			, CS_TYPE_ACT09 = #{csTypeAct09}
			, CS_TYPE_ACT10 = #{csTypeAct10}
			, CS_GROUP_A01  = #{csGroupA01}
			, CS_GROUP_A02  = #{csGroupA02}
			, CS_GROUP_A03  = #{csGroupA03}
			, CS_GROUP_A04  = #{csGroupA04}
			, CS_GROUP_A05  = #{csGroupA05}
			, CS_GROUP_A06  = #{csGroupA06}
			, CS_GROUP_A07  = #{csGroupA07}
			, CS_GROUP_A08  = #{csGroupA08}
			, CS_GROUP_A09  = #{csGroupA09}
			, CS_GROUP_A10  = #{csGroupA10}
			, CS_GROUP_B10  = #{csGroupB10}
			, CS_GROUP_B20  = #{csGroupB20}
			, CS_GROUP_B30  = #{csGroupB30}
			, CS_GROUP_B40  = #{csGroupB40}
			, CS_GROUP_B50  = #{csGroupB50}
			, CS_GROUP_B60  = #{csGroupB60}
			, CS_GROUP_B61  = #{csGroupB61}
			, CS_GROUP_B62  = #{csGroupB62}
			, CS_GROUP_C10  = #{csGroupC10}
			, CS_GROUP_C20  = #{csGroupC20}
			, CS_GROUP_C21  = #{csGroupC21}
			, CS_GROUP_C22  = #{csGroupC22}
			, CS_GROUP_D10  = #{csGroupD10}
			, CS_GROUP_B51  = #{csGroupB51}
			, CS_GROUP_C23  = #{csGroupC23}
			, CS_GROUP_C24  = #{csGroupC24}
			, CS_GROUP_C22_MEMO  = #{csGroupC22Memo}
			, CS_GROUP_C23_MEMO  = #{csGroupC23Memo}
			, CS_GROUP_C24_MEMO  = #{csGroupC24Memo}
			, CS_MEMO         = #{csMemo}
			, OLD_SUPT_CNTS   = #{oldSuptCnts}
			, OLD_CSLOR_OPIN  = #{oldCslorOpin}
			, OLD_OTHER_CSL_CNTS = #{oldOtherCslCnts}
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</update>
	
	<!-- 사례부가정보 삭제 -->
	<delete id="deleteCaseServ" parameterType="zvl">
		<![CDATA[
		/* deleteCaseServ */
		DELETE
		  FROM TA_CASE_SERV
		 WHERE CASE_SEQ = #{caseSeq}
		]]>
	</delete>
	
    <!-- 출력 히스토리 저장 -->
    <insert id="savePrintHistory" parameterType="zvl">
        <![CDATA[
        /* savePrintHistory */
                INSERT INTO TA_PRINT_HISTORY (
                  PH_SEQ,PH_USER_ID,PH_USER_NAME,CASE_SEQ,PH_NAME,PH_GROUP,PH_GROUP_SEQ,PH_CDATE 
                ) values (
			                  #{phSeq     }
			                , #{userId    }
			                , #{userName  } 
			                , #{caseSeq   }
			                , #{phName    }
			                , #{phGroup   }
			                , #{phGroupSeq}
			                , NOW()
                ) 
        ]]>
    </insert>
    
    <!-- 출력 히스토리 index 조회 -->
    <select id="getPhSeq" parameterType="zvl" resultType="long">
        <![CDATA[
        SELECT PH_SEQ FROM TA_PRINT_HISTORY ORDER BY PH_SEQ DESC LIMIT 1
        ]]>
    </select>
    
    <!-- 사례관리자 리스트 조회 -->
    <select id="findCaseManager" parameterType="zvl" resultType="zvl">
        <![CDATA[
        /*findCaseManager*/
        SELECT USER_ID, USER_NAME
		 FROM TA_USER
		  WHERE CENTER_CODE = (SELECT CENTER_CODE
						  FROM TA_USER 
						 WHERE USER_ID = #{loginUserId})
		   AND USER_STATE= 'Y'
        ]]>
    </select>
    
    <!-- 센터별 접수 담당자 조회 리스트 -->
    <select id="findCaseCenterList" parameterType="zvl" resultType="zvl">
        <![CDATA[
        /*findCaseCenterList*/
        SELECT USER_ID, USER_NAME  
		 FROM TA_USER
		 WHERE 1 = 1
        ]]>
        <if test='centerCodeSub != null and centerCodeSub != ""'>
			<![CDATA[   AND CENTER_CODE = #{centerCodeSub}     ]]>
		</if>
		<if test='srcState != null and srcState != ""'>
			<![CDATA[   AND USER_STATE = #{srcState}   ]]>
		</if>
    </select>
    
	<update id="updateCase2" parameterType="zvl">
		<![CDATA[
		/* updateCase2 */
		
		UPDATE	TA_CASE
		SET		CENTER_NUMBER = #{centerNumber}
				, CASE_REL = #{caseRel}
				, CASE_REL_SEQ = #{caseRelSeq}
				, CASE_VISIT = (CASE (SELECT COUNT(*) FROM TA_PASS WHERE CASE_SEQ='5426979' AND PASS_WAY='2') WHEN 0 THEN '1' ELSE '2' END)
				, CLIENT_REL_MEMO = #{clientRelMemo}
				, VICTIM_NAME = #{victimName}
				, CLIENT = ECL_ENCRYPT(#{client})
				, DMG_TIME = #{dmgTime}
				, DMG_TIME_MEMO = #{dmgTimeMemo}
				, CASE_MANAGER = #{caseManager}
				, CASE_UDATE = NOW()
		WHERE	CASE_SEQ= #{caseSeq}
		]]>
	</update>
	
	<select id="findCaseRelSeqByCaseNumber" parameterType="zvl" resultType="zvl">
		<![CDATA[
			SELECT	CASE_SEQ
			FROM	TA_CASE
			WHERE	CASE_NUMBER = #{caseNumber}
					AND CASE_DELETED = 'N'
		]]>
	</select>
</mapper>
